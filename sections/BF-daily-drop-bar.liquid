{%- comment -%}
  BLACK FRIDAY COMMAND CENTER (V3.1 - Centered Hierarchy)
  - Mobile: Header elements are now stacked and centered for better visual hierarchy.
  - Desktop: Header is centered.
  - Updated "Snack" card to "Pantry Stock Up".
{%- endcomment -%}

{% if section.settings.enable_bar %}
<div class="bf-dash-wrapper" id="bf-dash-section" data-end-time="{{ section.settings.drop_end_date }}">
  
  <!-- CONTEXT HEADER: Centered & Stacked on Mobile -->
  <div class="bf-dash-header-row">
    <div class="bf-dash-indicator">
      <span class="bf-pulse"></span>
      <span class="bf-live-text">BLACK FRIDAY LIVE</span>
    </div>
    <div class="bf-dash-headline">SHOP LIMITED TIME FLASH DEALS</div>
  </div>

  <div class="bf-dash-container">
    
    <!-- 1. MEAL DROP -->
    <a href="{{ section.settings.drop_link }}" class="bf-dash-card bf-dash-card--primary">
      <div class="bf-dash-badge">DEAL OF THE DAY</div>
      <div class="bf-dash-inner">
        <div class="bf-dash-media">
          {% if section.settings.drop_image %}
            <img src="{{ section.settings.drop_image | image_url: width: 160 }}" loading="eager" alt="Daily Drop">
          {% else %}
            <div class="bf-dash-placeholder"></div>
          {% endif %}
        </div>
        <div class="bf-dash-content">
          <div class="bf-dash-eyebrow">Ends Midnight</div>
          <div class="bf-dash-title">{{ section.settings.drop_title }}</div>
          <div class="bf-dash-meta">
            <span class="bf-dash-price">{{ section.settings.drop_price }}</span>
            <span class="bf-dash-timer" id="bf-dash-timer">--:--:--</span>
          </div>
        </div>
        <div class="bf-dash-arrow">→</div>
      </div>
    </a>

    <!-- 2. SUBSCRIPTION -->
    <a href="{{ section.settings.sub_link }}" class="bf-dash-card">
      <div class="bf-dash-badge bf-dash-badge--red">BEST VALUE</div>
      <div class="bf-dash-inner">
        <div class="bf-dash-icon-wrap">
          <svg fill="#E63946" height="200px" width="200px" version="1.1" id="XMLID_124_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="plan"> <g> <path d="M24,24H0V3h5V0h2v3h10V0h2v3h5V24z M2,22h20V5H2v3h20v2H2V22z M19,19H9v-2h10V19z M7,19H5v-2h2V19z M19,15H9v-2h10V15z M7,15H5v-2h2V15z"></path> </g> </g> </g></svg>
        </div>
        <div class="bf-dash-content">
          <div class="bf-dash-eyebrow">Meal Plans</div>
          <div class="bf-dash-title">Save up to $180</div>
          <div class="bf-dash-sub">Auto-applied at checkout</div>
        </div>
        <div class="bf-dash-arrow">→</div>
      </div>
    </a>

    <!-- 3. PANTRY STOCK UP -->
    <a href="{{ section.settings.snack_link }}" class="bf-dash-card">
      <div class="bf-dash-badge bf-dash-badge--yellow">LIMITED STOCK</div>
      <div class="bf-dash-inner">
        <div class="bf-dash-icon-wrap bf-dash-icon-wrap--yellow">
          <svg viewBox="0 0 24 24" id="_24x24_On_Light_Media" data-name="24x24/On Light/Media" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <rect id="view-box" width="24" height="24" fill="none"></rect> <path id="Shape" d="M4.466,19.5a2.737,2.737,0,0,1-2.718-2.332L.009,5.864A.75.75,0,0,1,.751,5h.3a2.444,2.444,0,0,1,.474-2.075,2.551,2.551,0,0,1,2.369-.87A2.416,2.416,0,0,1,5.6.382,2.6,2.6,0,0,1,7.961.945,2.561,2.561,0,0,1,10.5.076a2.281,2.281,0,0,1,1.724,1.762A2.513,2.513,0,0,1,14.4,3.5,2.63,2.63,0,0,1,14.468,5h.283a.75.75,0,0,1,.742.864l-1.74,11.3A2.735,2.735,0,0,1,11.034,19.5ZM11.034,18A1.243,1.243,0,0,0,12.27,16.94L13.876,6.5H11.012L10.489,18ZM8.988,18,9.51,6.5H5.989L6.512,18ZM3.23,16.94A1.244,1.244,0,0,0,4.466,18H5.01L4.488,6.5H1.625ZM12.905,5A1.465,1.465,0,0,0,13,4.04c-.207-.54-.606-.766-1.378-.725a.75.75,0,0,1-.789-.714c-.031-.661-.242-.956-.695-1.072s-.925.146-1.5.949a.751.751,0,0,1-1.174.057c-.55-.628-1.016-.823-1.47-.7-.438.117-.694.467-.788,1.212a.751.751,0,0,1-.975.618C3.466,3.417,3,3.51,2.661,3.9A1.221,1.221,0,0,0,2.578,5Z" transform="translate(4.25 2.251)" fill="#FFD000"></path> </g></svg>
        </div>
        <div class="bf-dash-content">
          <div class="bf-dash-eyebrow">Pantry Stock Up</div>
          <div class="bf-dash-title">Up to 40% Off</div>
          <div class="bf-dash-sub">Popcorn, Seasoning & More</div>
        </div>
        <div class="bf-dash-arrow">→</div>
      </div>
    </a>

  </div>
</div>

<style>
  /* ─── LAYOUT RESET ─── */
  .bf-dash-wrapper {
    width: 100vw !important;
    position: relative !important;
    left: 50% !important;
    right: 50% !important;
    margin-left: -50vw !important;
    margin-right: -50vw !important;
    background-color: #111111 !important;
    border-top: 4px solid #E63946 !important;
    border-bottom: 1px solid #333 !important;
    padding: 0 !important;
    overflow: hidden;
    z-index: 5;
  }

  /* ─── HEADER ROW (UPDATED) ─── */
  .bf-dash-header-row {
    max-width: 1600px;
    margin: 0 auto;
    padding: 16px 40px 4px; /* Balanced top padding */
    display: flex;
    align-items: center;
    justify-content: center; /* Center align desktop */
    gap: 12px;
  }

  .bf-dash-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(230, 57, 70, 0.15);
    border: 1px solid rgba(230, 57, 70, 0.4);
    padding: 4px 10px;
    border-radius: 4px;
    white-space: nowrap;
  }

  .bf-pulse {
    width: 6px; height: 6px; border-radius: 50%;
    background-color: #E63946;
    box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.7);
    animation: bf-pulse-anim 2s infinite;
  }
  @keyframes bf-pulse-anim {
    0% { box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.7); }
    70% { box-shadow: 0 0 0 6px rgba(230, 57, 70, 0); }
    100% { box-shadow: 0 0 0 0 rgba(230, 57, 70, 0); }
  }

  .bf-live-text {
    color: #E63946; font-size: 10px; font-weight: 800; letter-spacing: 0.05em; text-transform: uppercase;
  }

  .bf-dash-headline {
    color: #999;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  /* ─── CARD CONTAINER ─── */
  .bf-dash-container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 12px 40px 20px;
    display: grid;
    grid-template-columns: 1.3fr 1fr 1fr;
    gap: 20px;
  }

  /* ─── CARD STYLES ─── */
  .bf-dash-card {
    position: relative;
    background: #1A1A1A !important;
    border: 1px solid #333 !important;
    border-radius: 8px !important;
    padding: 16px 20px !important;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-decoration: none !important;
    transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease !important;
    color: white !important;
  }

  .bf-dash-card:hover {
    transform: translateY(-4px);
    background: #222 !important;
    border-color: #555 !important;
  }
  .bf-dash-card--primary:hover {
    border-color: #E63946 !important;
  }

  .bf-dash-inner {
    display: flex;
    align-items: center;
    gap: 16px;
    width: 100%;
  }

  /* ─── BADGES ─── */
  .bf-dash-badge {
    position: absolute;
    top: 0;
    right: 0;
    background: #333;
    color: #fff;
    font-size: 9px;
    font-weight: 800;
    padding: 4px 10px;
    border-bottom-left-radius: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1;
  }
  .bf-dash-badge--red { background: #E63946 !important; }
  .bf-dash-badge--yellow { background: #FFD000 !important; color: #000 !important; }

  /* ─── VISUALS ─── */
  .bf-dash-media {
    width: 64px; height: 64px; border-radius: 6px; overflow: hidden; flex-shrink: 0;
    border: 1px solid #444; background: #fff;
  }
  .bf-dash-media img { width: 100%; height: 100%; object-fit: cover; display: block; }
  
  .bf-dash-icon-wrap {
    width: 48px; height: 48px; border-radius: 50%;
    background: rgba(230, 57, 70, 0.1);
    color: #E63946;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .bf-dash-icon-wrap--yellow {
    background: rgba(255, 208, 0, 0.1);
    color: #FFD000;
  }

  /* ─── CONTENT ─── */
  .bf-dash-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .bf-dash-eyebrow {
    font-size: 10px; text-transform: uppercase; color: #888; font-weight: 700; letter-spacing: 0.5px;
  }

  .bf-dash-title {
    font-family: 'Inter', sans-serif !important;
    font-size: 14px; font-weight: 800; color: #fff !important;
    text-transform: uppercase; line-height: 1.2;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  .bf-dash-meta {
    display: flex; align-items: center; gap: 8px; margin-top: 2px;
  }

  .bf-dash-price { font-size: 18px; font-weight: 900; color: #E63946; }
  .bf-dash-sub { font-size: 11px; color: #aaa; line-height: 1.3; }

  .bf-dash-timer {
    font-family: monospace; background: #000; color: #E63946;
    padding: 2px 6px; border-radius: 4px;
    font-size: 12px; font-weight: 700;
    border: 1px solid #333;
  }

  .bf-dash-arrow {
    font-size: 20px; color: #444; transition: transform 0.2s ease, color 0.2s ease;
  }
  .bf-dash-card:hover .bf-dash-arrow { color: #fff; transform: translateX(4px); }

  /* ─── MOBILE (STACK & CENTER) ─── */
  @media (max-width: 1024px) {
    .bf-dash-header-row {
      flex-direction: column; /* Stack vertically */
      gap: 8px; /* Tighter gap */
      padding: 16px 20px 4px;
      text-align: center;
    }
    
    .bf-dash-headline {
      font-size: 10px;
      line-height: 1.4;
      max-width: 280px; /* Force distinct 2 lines if needed, or keep tight */
    }

    .bf-dash-container {
      padding: 12px 20px 20px;
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      gap: 12px;
      -webkit-overflow-scrolling: touch;
    }
    
    .bf-dash-card {
      min-width: 280px;
      scroll-snap-align: center;
      flex-shrink: 0;
    }

    .bf-dash-container::-webkit-scrollbar { display: none; }
    .bf-dash-container { scrollbar-width: none; }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const section = document.getElementById('bf-dash-section');
  if(!section) return;

  const timerDisplay = document.getElementById('bf-dash-timer');
  const endDateStr = section.dataset.endTime; 

  if(endDateStr && timerDisplay) {
    const calculateTime = () => {
      const now = new Date().getTime();
      const end = new Date(endDateStr).getTime();
      const distance = end - now;

      if (distance < 0) {
        timerDisplay.textContent = "ENDED";
        timerDisplay.style.color = "#666";
        return false;
      }

      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      const pad = (n) => n < 10 ? "0" + n : n;
      timerDisplay.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
      return true;
    };

    calculateTime();
    setInterval(calculateTime, 1000);
  }
});
</script>
{% endif %}

{% schema %}
{
  "name": "BF Dashboard (FullWidth)",
  "settings": [
    { "type": "checkbox", "id": "enable_bar", "label": "Enable Section", "default": true },
    
    { "type": "header", "content": "Deal 1: The Drop" },
    { "type": "text", "id": "drop_title", "label": "Title", "default": "Salsa Verde Chicken" },
    { "type": "image_picker", "id": "drop_image", "label": "Image" },
    { "type": "text", "id": "drop_price", "label": "Price", "default": "$8.00" },
    { "type": "text", "id": "drop_end_date", "label": "End Date (ISO)", "default": "2025-11-29T02:00:00" },
    { "type": "url", "id": "drop_link", "label": "Link" },

    { "type": "header", "content": "Deal 2: Subscription" },
    { "type": "url", "id": "sub_link", "label": "Link" },

    { "type": "header", "content": "Deal 3: Pantry/Snacks" },
    { "type": "url", "id": "snack_link", "label": "Link" }
  ],
  "presets": [
    { "name": "BF Dashboard (FullWidth)" }
  ]
}
{% endschema %}
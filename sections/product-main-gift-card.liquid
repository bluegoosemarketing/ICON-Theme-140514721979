{% comment %}
  Product: Gift Card (Main)
  - Styled to match the standard "with-sidebar" layout
  - Keeps the lightweight variant dropdown + live price update
  - Uses Shopify's native product form so cart drawer behaviour stays intact
{% endcomment %}

{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}
{%- assign primary_collection = collection -%}
{%- if primary_collection == blank and product.collections.size > 0 -%}
  {%- assign primary_collection = product.collections.first -%}
{%- endif -%}

<div id="product-main-{{ section.id }}" class="product-main product-main--gift" data-gift-card-root data-section-id="{{ section.id }}">
  <style>
    :root {
      --brand-primary: #2a9d8f;
      --brand-primary-light: #f0fdfa;
      --brand-primary-border: rgba(42, 157, 143, 0.4);
      --text-on-brand: #ffffff;
      --border-color-soft: #e9ecef;
      --background-soft: #f8f9fa;
      --text-primary: #0f172a;
      --text-secondary: #495057;
    }

    #product-main-{{ section.id }} {
      --product-mobile-gutter: clamp(1rem, 4vw, 1.5rem);
    }

    #product-main-{{ section.id }} .product-main__layout {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      padding: 1.5rem 1.2rem;
    }

    #product-main-{{ section.id }} .product-main__visuals-wrapper,
    #product-main-{{ section.id }} .product-main__info-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    #product-main-{{ section.id }} .product-main__gallery-image-wrapper {
      background: #fff;
      border-radius: 12px;
      border: 1px solid var(--border-color-soft);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 0.75rem;
    }

    #product-main-{{ section.id }} .product-main__gallery-image {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
    }

    #product-main-{{ section.id }} .product-intro-card {
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, #ffffff 0%, #f8fffb 55%, #f0fdfa 100%);
      border: 1px solid rgba(42, 157, 143, 0.14);
      border-radius: 18px;
      padding: clamp(1.75rem, 4vw, 2.5rem);
      display: flex;
      flex-direction: column;
      gap: clamp(1.5rem, 3vw, 2.25rem);
      box-shadow: 0 28px 45px rgba(15, 23, 42, 0.08);
    }

    #product-main-{{ section.id }} .product-intro-card::before {
      content: "";
      position: absolute;
      inset: auto -35% 20% auto;
      width: 320px;
      height: 320px;
      background: radial-gradient(circle at center, rgba(42, 157, 143, 0.18) 0%, rgba(42, 157, 143, 0) 70%);
      opacity: 0.9;
      pointer-events: none;
    }

    #product-main-{{ section.id }} .product-intro-card::after {
      content: "";
      position: absolute;
      top: -110px;
      left: -110px;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle at center, rgba(236, 72, 153, 0.12) 0%, rgba(236, 72, 153, 0) 70%);
      pointer-events: none;
    }

    #product-main-{{ section.id }} .product-main__header {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    #product-main-{{ section.id }} .product-main__meta-line {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
    }

    #product-main-{{ section.id }} .product-main__eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.85rem;
      border-radius: 999px;
      background: rgba(42, 157, 143, 0.12);
      color: #1f766b;
      font-weight: 700;
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-decoration: none;
    }

    #product-main-{{ section.id }} .product-main__eyebrow:hover,
    #product-main-{{ section.id }} .product-main__eyebrow:focus {
      color: #1f766b;
      text-decoration: none;
    }

    #product-main-{{ section.id }} .product-main__title {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
      font-size: clamp(2rem, 3vw, 2.8rem) !important;
      font-weight: 800 !important;
      line-height: 1.05 !important;
      color: var(--text-primary) !important;
      letter-spacing: -0.025em;
      margin: 0;
    }

    #product-main-{{ section.id }} .product-main__price {
      position: relative;
      z-index: 1;
      display: inline-flex;
      align-items: center;
      padding: 0.6rem 1.25rem;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(15, 23, 42, 0.1);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05), 0 8px 20px rgba(15, 23, 42, 0.08);
      font-size: clamp(1.2rem, 1.8vw, 1.5rem);
      font-weight: 800;
      color: var(--text-primary);
    }

    #product-main-{{ section.id }} .product-summary-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      color: var(--text-secondary);
      font-size: 1.05rem;
      line-height: 1.8;
    }

    #product-main-{{ section.id }} .product-main__form {
      border-radius: 18px;
      background: linear-gradient(135deg, #fdfdfd 0%, #f7fdfb 60%, #f5fbf9 100%);
      border: 1px solid rgba(42, 157, 143, 0.1);
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.07);
      padding: clamp(1.25rem, 4vw, 2rem);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    #product-main-{{ section.id }} .product-main__options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    #product-main-{{ section.id }} .product-main__options label {
      display: block;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.35rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    #product-main-{{ section.id }} .product-main__options select {
      width: 100%;
      appearance: none;
      border-radius: 10px;
      border: 1px solid var(--border-color-soft);
      background: #fff;
      padding: 0.85rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    #product-main-{{ section.id }} .product-main__actions {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 1rem;
      align-items: stretch;
    }

    #product-main-{{ section.id }} .quantity-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--brand-primary);
      border-radius: 10px;
      color: var(--text-on-brand);
      height: 50px;
      padding: 0 0.5rem;
    }

    #product-main-{{ section.id }} .quantity-controls__button {
      background: transparent;
      border: none;
      color: inherit;
      font-size: 1.5rem;
      font-weight: 700;
      width: 48px;
      height: 100%;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }

    #product-main-{{ section.id }} .quantity-controls__button:hover,
    #product-main-{{ section.id }} .quantity-controls__button:focus {
      opacity: 0.8;
    }

    #product-main-{{ section.id }} .quantity-controls input {
      width: 100%;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 1.15rem;
      font-weight: 700;
      text-align: center;
      outline: none;
    }

    #product-main-{{ section.id }} .product-main-add-to-cart {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      width: 100%;
      background-color: transparent;
      color: var(--brand-primary);
      border: 2px solid var(--brand-primary);
      border-radius: 10px;
      height: 50px;
      padding: 1rem;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    #product-main-{{ section.id }} .product-main-add-to-cart:hover,
    #product-main-{{ section.id }} .product-main-add-to-cart:focus {
      background-color: var(--brand-primary-light);
    }

    #product-main-{{ section.id }} .gift-product-message {
      border-radius: 12px;
      background: rgba(42, 157, 143, 0.1);
      color: #1f766b;
      font-weight: 600;
      padding: 1rem 1.25rem;
      text-align: center;
    }

    @media (max-width: 1023px) {
      #product-main-{{ section.id }} .product-main__layout {
        padding: 0;
        gap: 0;
      }

      #product-main-{{ section.id }} .product-main__visuals-wrapper {
        gap: 0;
        border-bottom: 1px solid var(--border-color-soft);
        padding-bottom: 1.5rem;
        background: #fff;
      }

      #product-main-{{ section.id }} .product-main__gallery-image-wrapper {
        border-radius: 0;
        border-left: 0;
        border-right: 0;
        border-top: 0;
        box-shadow: none;
        padding: 0;
      }

      #product-main-{{ section.id }} .product-main__gallery-image {
        border-radius: 0;
      }

      #product-main-{{ section.id }} .product-main__info-column {
        padding: 1.5rem var(--product-mobile-gutter);
        background: var(--background-soft);
      }

      #product-main-{{ section.id }} .product-main__actions {
        grid-template-columns: 1fr;
      }
    }

    @media (min-width: 1024px) {
      #product-main-{{ section.id }} .product-main__layout {
        display: grid;
        grid-template-columns: 45fr 55fr;
        grid-template-areas: "visuals info";
        gap: 2rem;
        padding: 1.5rem 0;
      }

      #product-main-{{ section.id }} .product-main__visuals-wrapper {
        grid-area: visuals;
        position: sticky;
        top: 1.5rem;
      }

      #product-main-{{ section.id }} .product-main__info-column {
        grid-area: info;
      }
    }
  </style>

  <div class="product-main__layout">
    <div class="product-main__visuals-wrapper">
      {% if featured_image %}
        <div class="product-main__gallery">
          <div class="product-main__gallery-image-wrapper">
            <img
              src="{{ featured_image | image_url: width: 900, height: 900, crop: 'center' }}"
              alt="{{ featured_image.alt | escape }}"
              class="product-main__gallery-image"
              loading="eager"
              width="900"
              height="{{ 900 | divided_by: featured_image.aspect_ratio | round }}">
          </div>
        </div>
      {% endif %}
    </div>

    <div class="product-main__info-column">
      <div class="product-intro-card">
        <div class="product-main__header">
          <div class="product-main__meta-line">
            {% if primary_collection %}
              <a class="product-main__eyebrow" href="{{ primary_collection.url }}">{{ primary_collection.title }} • ICON Meals</a>
            {% else %}
              <span class="product-main__eyebrow">ICON Meals Gift Card</span>
            {% endif %}
          </div>
          <h1 class="product-main__title">{{ product.title }}</h1>
          <div class="product-main__price"><span data-price>{{ current_variant.price | money }}</span></div>
        </div>

        <div class="product-summary-content">
          <div class="gift-product-message" role="status">
            Choose a value, add it to your cart, and share the gift of ICON Meals in seconds.
          </div>
          {% if product.description != blank %}
            <div class="product-description rte">{{ product.description }}</div>
          {% endif %}
        </div>
      </div>

      {% form 'product', product, id: "gift-card-form-{{ section.id }}", class: 'product-main__form gift-card-form', novalidate: 'novalidate' %}
        <div class="product-main__options">
          <div class="form-row">
            <label for="GiftCardVariant-{{ section.id }}">Value</label>
            <select id="GiftCardVariant-{{ section.id }}" name="id" data-gift-card-variant>
              {%- for v in product.variants -%}
                <option value="{{ v.id }}" {% if v.id == current_variant.id %}selected{% endif %}>
                  {{ v.title }}{% unless v.available %} — {{ 'products.product.sold_out' | t }}{% endunless %}
                </option>
              {%- endfor -%}
            </select>
          </div>
        </div>

        <div class="product-main__actions">
          <div class="quantity-controls">
            <button type="button" class="quantity-controls__button qty-minus" aria-label="Decrease quantity" data-qty-minus>−</button>
            <input type="number" name="quantity" value="1" min="1" aria-label="Quantity" data-qty-input>
            <button type="button" class="quantity-controls__button qty-plus" aria-label="Increase quantity" data-qty-plus>+</button>
          </div>
          <button type="submit" class="product-main-add-to-cart">+ Add</button>
        </div>
      {% endform %}
    </div>
  </div>
</div>

<script>
  (function() {
    var root = document.currentScript.closest('[data-gift-card-root]');
    if (!root) return;

    var select = root.querySelector('[data-gift-card-variant]');
    var priceEl = root.querySelector('[data-price]');
    var minus = root.querySelector('[data-qty-minus]');
    var plus = root.querySelector('[data-qty-plus]');
    var input = root.querySelector('[data-qty-input]');

    var variants = [
      {% for v in product.variants %}
      { id: {{ v.id }}, price: "{{ v.price | money }}" }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    function updatePrice() {
      if (!select || !priceEl) return;
      var id = parseInt(select.value, 10);
      var variant = variants.find(function(v) { return v.id === id; });
      if (variant) {
        priceEl.innerHTML = variant.price;
      }
    }

    function clampQuantity(value) {
      var parsed = parseInt(value, 10);
      if (isNaN(parsed) || parsed < 1) return 1;
      return parsed;
    }

    if (select) {
      select.addEventListener('change', updatePrice);
      updatePrice();
    }

    if (input) {
      input.addEventListener('change', function() {
        input.value = clampQuantity(input.value);
      });
    }

    if (minus) {
      minus.addEventListener('click', function() {
        if (!input) return;
        input.value = clampQuantity((parseInt(input.value, 10) || 1) - 1);
      });
    }

    if (plus) {
      plus.addEventListener('click', function() {
        if (!input) return;
        input.value = clampQuantity((parseInt(input.value, 10) || 1) + 1);
      });
    }
  })();
</script>

{% schema %}
{
  "name": "Product: Gift Card (Simple)",
  "settings": [],
  "presets": [{ "name": "Product: Gift Card (Simple)" }]
}
{% endschema %}

{% comment %}
=====================================================================================
  CUSTOM MEAL PLAN HEADER SECTION
  Version: 15.2 - Promo Line UI Enhancement
  - REFINED: The '.mp-promo-line' has been completely restyled to match the new,
    world-class promo callout component from the product page, ensuring a
    consistent and professional user experience.
=====================================================================================
{% endcomment %}

{%- liquid
  assign promo_end = settings.meal_plan_promo_end_date | default: ''
  assign promo_active = false
  if settings.meal_plan_promo_enable and settings.meal_plan_promo_list_enable
    assign now_ts = 'now' | date: '%s'
    assign end_ts = promo_end | date: '%s'
    if promo_end == blank or end_ts >= now_ts
      assign promo_active = true
    endif
  endif
  assign s12 = settings.meal_plan_promo_savings_12 | plus: 0
  assign s24 = settings.meal_plan_promo_savings_24 | plus: 0
  assign max_savings_single = s12
  if s24 > s12
    assign max_savings_single = s24
  endif
  assign max_savings_total = max_savings_single | times: 4
-%}

<style>
  .meal-plan-header-wrapper {
    padding: 40px 0;
    background-color: {{ section.settings.background_color }};
  }
  @media (min-width: 992px) {
    .meal-plan-header-wrapper {
      padding: 60px 0;
    }
  }

  .meal-plan-header {
    display: grid;
    gap: 1.5rem 2rem;
    text-align: left;
    align-items: center;
  }
  @media (min-width: 992px) {
    .meal-plan-header {
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    }
  }
  @media (max-width: 991px) {
    .meal-plan-header { text-align: center; }
    .meal-plan-header__main-content { margin: 0 auto; max-width: 500px; }
    .meal-plan-header__features { max-width: 450px; margin: 0 auto; text-align: left; }
  }

  .meal-plan-header__eyebrow {
    font-size: 0.875rem;
    font-weight: 700;
    color: #d42828;
    text-transform: uppercase;
    letter-spacing: 0.075em;
    margin-bottom: 0.75rem;
  }

  .meal-plan-header__heading {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
    font-size: 3rem !important;
    font-weight: 800 !important;
    line-height: 1.15 !important;
    margin: 0 !important;
    color: #212529 !important;
    letter-spacing: -0.025em;
  }

  .meal-plan-header__intro {
    font-size: 1.125rem;
    line-height: 1.6;
    color: #495057;
    margin-top: 1.25rem;
  }
  .meal-plan-header__intro p { margin: 0; }

  .header-feature-list {
    list-style: none; padding: 0; margin: 0;
    display: flex; flex-direction: column; gap: 1rem;
    border-left: 3px solid #e9ecef;
    padding-left: 1.5rem;
  }
  .header-feature-item {
    display: flex; align-items: flex-start; gap: 1rem;
    font-size: 1rem; font-weight: 500; color: #343a40;
  }
  .header-feature-item svg {
    flex-shrink: 0; width: 24px; height: 24px; margin-top: 2px;
    color: var(--brand-accent, #2EBF7A);
  }

  @media (max-width: 991px) {
    .header-feature-list { border-left: none; padding-left: 0; }
  }
  @media (max-width: 767px) {
    .meal-plan-header__heading { font-size: 2.25rem !important; }
    .meal-plan-header__intro { font-size: 1rem; }
  }

  /* NEW PROMO LINE STYLES */
  .mp-promo-line {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-top: 1.5rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    background-color: #fdf5f5;
    border: 1px solid #f5c6cb;
    text-align: left;
  }
  .mp-promo-line__icon {
    flex-shrink: 0;
    font-size: 1.2rem;
    line-height: 1.4;
    margin-top: 1px;
  }
  .mp-promo-line__text {
    display: flex;
    flex-direction: column;
  }
  .mp-promo-line__title {
    font-size: 0.9rem;
    font-weight: 700;
    color: #d42828;
    line-height: 1.4;
    margin-bottom: 0.25rem;
  }
  .mp-promo-line__subtitle {
    font-size: 0.8rem;
    color: #212529;
    line-height: 1.5;
  }
  .mp-promo-how {
    display: inline-block;
    margin-left: 4px;
  }
  .mp-promo-how summary {
    cursor: pointer;
    font-size: inherit;
    color: #495057;
    display: inline;
    font-weight: 500;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-underline-offset: 2px;
  }
  .mp-promo-how summary:hover {
    color: #d42828;
  }
  .mp-promo-how[open] summary {
    margin-bottom: 0.25rem;
  }
  .mp-promo-how div {
    font-size: 0.8rem;
    color: #495057;
    margin-top: 0.5rem;
    font-weight: 400;
  }
</style>

<div class="meal-plan-header-wrapper">
  <div class="container">
    <div class="meal-plan-header">
      <div class="meal-plan-header__main-content">
        {%- if section.settings.eyebrow != blank -%}
          <p class="meal-plan-header__eyebrow">{{ section.settings.eyebrow | escape }}</p>
        {%- endif -%}
        {%- if section.settings.title != blank -%}
          <h2 class="meal-plan-header__heading">{{ section.settings.title | escape }}</h2>
        {%- endif -%}
        {%- if section.settings.intro_text != blank -%}
          <div class="meal-plan-header__intro rte">{{ section.settings.intro_text }}</div>
        {%- endif -%}
        
        {% if promo_active %}
          <div class="mp-promo-line">
            <span class="mp-promo-line__icon">âš¡</span>
            <div class="mp-promo-line__text">
              <span class="mp-promo-line__title">{{ settings.meal_plan_promo_name }} is live!</span>
              <span class="mp-promo-line__subtitle">
                <strong>Black Friday Deal:</strong> Secure up to $180 in total savings automatically applied to your next 4 orders when you choose "Subscribe & Save." The ultimate way to fuel your holidays.
              </span>
            </div>
          </div>
        {% endif %}
      </div>
      <div class="meal-plan-header__features">
        <ul class="header-feature-list">
          {%- if section.settings.feature_1_text != blank -%}
            <li class="header-feature-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
              <span>{{ section.settings.feature_1_text }}</span>
            </li>
          {%- endif -%}
          {%- if section.settings.feature_2_text != blank -%}
             <li class="header-feature-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
              <span>{{ section.settings.feature_2_text }}</span>
            </li>
          {%- endif -%}
          {%- if section.settings.feature_3_text != blank -%}
             <li class="header-feature-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
              <span>{{ section.settings.feature_3_text }}</span>
            </li>
          {%- endif -%}
        </ul>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Meal Plan Page Header",
  "class": "meal-plan-header-section",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "PRE-BUILT MEAL PLANS"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Main Title",
      "default": "Chef-Crafted Plans for Any Goal"
    },
    {
      "type": "richtext",
      "id": "intro_text",
      "label": "Intro Paragraph",
      "default": "<p>Select a plan to see the exact meals, then customize your box. Every plan is flexible.</p>"
    },
    {
      "type": "header",
      "content": "Header Feature List"
    },
    {
      "type": "text",
      "id": "feature_1_text",
      "label": "Feature 1 Text",
      "default": "Expertly curated for balanced nutrition"
    },
    {
      "type": "text",
      "id": "feature_2_text",
      "label": "Feature 2 Text",
      "default": "Choose your size with 12 or 24 meal options"
    },
    {
      "type": "text",
      "id": "feature_3_text",
      "label": "Feature 3 Text",
      "default": "Flexible subscriptions you can pause or cancel anytime"
    }
  ],
  "presets": [
    {
      "name": "Meal Plan Page Header"
    }
  ],
  "enabled_on": {
    "templates": ["*"]
  }
}
{% endschema %}
{%- comment -%}
  Section: ICON Meals NYE Flash Sale (SCHEMA CACHE FIX)
  Description: 
    - Renamed Schema IDs to force Shopify to load new defaults.
    - Includes: Fast/Big Balloons + Video Fix + Varsity Styles.
{%- endcomment -%}

{%- liquid
  assign s = section.settings
  assign end_date = s.end_date_v2 | default: 'Jan 1, 2026 23:59:59'
  assign video_id = "T9tVnpNJcv8"
-%}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800;900&family=Teko:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<div id="im-balloon-container"></div>

<div class="nye-master-wrapper">
  
  <div class="nye-bg-rings">
    <div class="nye-ring-outer"></div>
    <div class="nye-ring-inner"></div>
  </div>

  <section class="nye-hero-section" aria-label="New Year Flash Sale">
    <div class="nye-container">
      
      <div class="nye-hero-text">
        <div class="nye-tagline">
          ⚡ {{ s.tagline_v2 }}
        </div>
        
        <h1 class="nye-headline">
          <span class="nye-solid">{{ s.headline_v2_1 }}</span>
          <span class="nye-slab">{{ s.headline_v2_2 }}</span>
        </h1>

        <div class="nye-desc">
          {{ s.description_v2 }}
        </div>

        <div class="nye-cta-group">
          <a href="{{ s.cta_link_v2 }}" class="nye-btn-primary">
            {{ s.cta_text_v2 }}
          </a>
          <div class="nye-guarantee">
            <span class="check-icon">✓</span> Code auto-applies at checkout
          </div>
        </div>
      </div>

      <div class="nye-hero-visual">
        <div class="nye-hud-card">
          <div class="nye-hud-header">
            <span class="nye-hud-label">LIMITED TIME OFFER</span>
            <div class="nye-hud-discount">{{ s.discount_amount_v2 }}</div>
            <span class="nye-hud-sub">SITEWIDE SAVINGS</span>
          </div>

          <div class="nye-code-frame" onclick="copyCode('{{ s.discount_code_v2 }}')">
             <div class="nye-code-label">TAP TO COPY CODE</div>
             <div class="nye-code-value" id="promoCode">{{ s.discount_code_v2 }}</div>
             <div class="nye-code-status" id="copyStatus">COPIED!</div>
          </div>

          <div class="nye-hud-divider"></div>

          <div class="nye-timer-container">
            <div class="nye-timer-label">OFFER EXPIRES IN:</div>
            <div class="nye-timer" id="nye-timer" data-date="{{ end_date }}">
              <div class="timer-box">
                <span class="t-val" id="t-hours">00</span>
                <span class="t-lbl">HRS</span>
              </div>
              <span class="t-sep">:</span>
              <div class="timer-box">
                <span class="t-val" id="t-minutes">00</span>
                <span class="t-lbl">MIN</span>
              </div>
              <span class="t-sep">:</span>
              <div class="timer-box">
                <span class="t-val" id="t-seconds">00</span>
                <span class="t-lbl">SEC</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <section class="nye-video-section">
    <div class="nye-video-container">
      
      <div class="nye-video-text">
        <h2 class="nye-video-title">THE CONSISTENCY PROTOCOL</h2>
        <p class="nye-video-quote">"Consistency requires preparation. With food already being prepped, it makes it easy for us to execute on a higher level."</p>
        <div class="nye-video-author">
          <strong>Mike Crowson</strong><br>
          <span style="opacity:0.7; font-size: 0.85em;">High Performance Entrepreneur</span>
        </div>
      </div>

      <div class="nye-video-wrapper">
        <div class="nye-phone-outer">
          <div class="nye-phone-screen">
            <iframe 
              src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&rel=0&modestbranding=1&controls=1&showinfo=0" 
              title="YouTube video player" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
            </iframe>
          </div>
        </div>
      </div>

    </div>
  </section>

  <div class="nye-dock">
    <div class="nye-dock-grid">
      <a href="{{ s.nav_1_link }}" class="nye-dock-card">
        <div class="nye-dock-sub">{{ s.nav_1_sub }}</div>
        <div class="nye-dock-title">{{ s.nav_1_title }} <span class="nye-arrow">→</span></div>
      </a>
      <a href="{{ s.nav_2_link }}" class="nye-dock-card">
        <div class="nye-dock-sub">{{ s.nav_2_sub }}</div>
        <div class="nye-dock-title">{{ s.nav_2_title }} <span class="nye-arrow">→</span></div>
      </a>
      <a href="{{ s.nav_3_link }}" class="nye-dock-card">
        <div class="nye-dock-sub">{{ s.nav_3_sub }}</div>
        <div class="nye-dock-title">{{ s.nav_3_title }} <span class="nye-arrow">→</span></div>
      </a>
      <a href="{{ s.nav_4_link }}" class="nye-dock-card">
        <div class="nye-dock-sub">{{ s.nav_4_sub }}</div>
        <div class="nye-dock-title">{{ s.nav_4_title }} <span class="nye-arrow">→</span></div>
      </a>
    </div>
  </div>

</div>

<style>
/* ─────────────────────────────────────────────────────────────
   ICON MEALS: NYE FLASH SALE (STYLES)
   ───────────────────────────────────────────────────────────── */

:root {
  --nye-bg: #fffcf7; 
  --nye-text: #0a0a0a;
  --nye-red: #D11F1F;
  --nye-font-head: 'Teko', sans-serif;
  --nye-font-body: 'Inter', sans-serif;
}

.nye-master-wrapper {
  width: 100% !important;
  overflow: hidden !important;
  position: relative !important;
  background-color: var(--nye-bg) !important;
  font-family: var(--nye-font-body) !important;
}

/* RINGS */
.nye-bg-rings {
  position: absolute; top: 30%; left: 75%; transform: translate(-50%, -50%);
  width: 1000px; height: 1000px; pointer-events: none; z-index: 0;
}
.nye-ring-outer {
  position: absolute; inset: 0; border: 1px solid rgba(209, 31, 31, 0.08) !important; border-radius: 50%;
}
.nye-ring-inner {
  position: absolute; inset: 100px; border: 1px dashed rgba(0,0,0,0.1) !important; border-radius: 50%;
}

/* HERO SECTION */
.nye-hero-section {
  position: relative !important;
  display: flex !important; align-items: center !important;
  padding: 60px 0 80px !important;
  z-index: 2 !important;
}

.nye-container {
  width: 100% !important; max-width: 1500px !important;
  margin: 0 auto !important; padding: 0 40px !important;
  display: grid !important; grid-template-columns: 1fr 1fr !important;
  align-items: center !important; gap: 40px !important;
}

/* TYPOGRAPHY */
.nye-hero-text {
  display: flex !important; flex-direction: column !important; justify-content: center !important;
  z-index: 5 !important;
}

.nye-tagline {
  color: var(--nye-red) !important;
  font-weight: 800 !important; text-transform: uppercase !important;
  letter-spacing: 2px !important; font-size: 0.9rem !important;
  margin-bottom: 1rem !important; display: flex !important; align-items: center !important; gap: 8px !important;
}

.nye-headline {
  font-family: var(--nye-font-head) !important;
  font-size: clamp(3.5rem, 5.5vw, 8rem) !important;
  line-height: 0.85 !important;
  text-transform: uppercase !important;
  margin: 0 0 2rem 0 !important;
  color: var(--nye-text) !important;
  font-weight: 700 !important;
}

.nye-solid { display: block !important; }

.nye-slab {
  color: #ffffff !important; 
  -webkit-text-stroke: 3px var(--nye-text) !important; 
  display: block !important;
  filter: drop-shadow(4px 6px 0px rgba(0,0,0,0.15)) !important;
  paint-order: stroke fill !important;
  transform: scale(1.02) !important; 
  transform-origin: left !important;
  margin-left: 2px !important; 
}

.nye-desc {
  font-size: 1.2rem !important; line-height: 1.6 !important; color: #444 !important;
  max-width: 500px !important; margin-bottom: 2.5rem !important;
  border-left: 4px solid var(--nye-red) !important; padding-left: 1.5rem !important;
}

/* BUTTONS */
.nye-btn-primary {
  background-color: var(--nye-red) !important; color: white !important;
  font-family: var(--nye-font-body) !important;
  padding: 1.2rem 3rem !important; font-size: 1.2rem !important;
  text-transform: uppercase !important; font-weight: 800 !important; letter-spacing: 1px !important;
  text-decoration: none !important; display: inline-block !important;
  box-shadow: 0 10px 20px rgba(209, 31, 31, 0.3) !important;
  clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
  transition: transform 0.2s ease !important;
  animation: pulseBtn 2s infinite;
}
@keyframes pulseBtn {
  0% { box-shadow: 0 0 0 0 rgba(209, 31, 31, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(209, 31, 31, 0); }
  100% { box-shadow: 0 0 0 0 rgba(209, 31, 31, 0); }
}
.nye-btn-primary:hover {
  background-color: #000 !important; transform: translateY(-2px) !important; color: #fff !important;
}

.nye-guarantee {
  margin-top: 15px !important; font-size: 0.85rem !important; color: #666 !important; font-weight: 600 !important;
}
.check-icon { color: var(--nye-red) !important; font-weight: 900 !important; }

/* OFFER HUD */
.nye-hero-visual {
  display: flex !important; justify-content: center !important; position: relative !important;
}
.nye-hud-card {
  background: rgba(255, 255, 255, 0.8) !important;
  backdrop-filter: blur(20px) !important; -webkit-backdrop-filter: blur(20px) !important;
  border: 1px solid #fff !important; box-shadow: 0 30px 60px rgba(0,0,0,0.1) !important;
  border-radius: 25px !important; padding: 40px !important;
  width: 100% !important; max-width: 450px !important; text-align: center !important;
  animation: slideUp 1s ease-out forwards !important;
}
.nye-hud-label {
  display: block !important; font-weight: 800 !important; font-size: 0.8rem !important;
  letter-spacing: 2px !important; color: var(--nye-red) !important; margin-bottom: 5px !important;
}
.nye-hud-discount {
  font-family: var(--nye-font-head) !important; font-size: 6.5rem !important; line-height: 0.85 !important;
  color: var(--nye-text) !important; font-weight: 700 !important; letter-spacing: -2px !important;
}
.nye-hud-sub {
  font-family: var(--nye-font-head) !important; font-size: 2rem !important; color: var(--nye-text) !important;
}
.nye-code-frame {
  background: #000 !important; color: #fff !important; padding: 15px !important;
  border-radius: 10px !important; cursor: pointer !important; margin: 25px 0 !important;
  position: relative !important; transition: transform 0.2s !important;
}
.nye-code-frame:active { transform: scale(0.98) !important; }
.nye-code-label { font-size: 0.7rem !important; opacity: 0.7 !important; display: block !important; margin-bottom: 2px !important; }
.nye-code-value { font-family: var(--nye-font-head) !important; font-size: 2.2rem !important; letter-spacing: 2px !important; line-height: 1 !important; }
.nye-code-status {
  position: absolute !important; inset: 0 !important; background: var(--nye-red) !important;
  display: flex !important; align-items: center !important; justify-content: center !important;
  border-radius: 10px !important; opacity: 0 !important; transition: opacity 0.3s !important;
  font-family: var(--nye-font-head) !important; font-size: 1.8rem !important;
}
.nye-code-status.visible { opacity: 1 !important; }
.nye-hud-divider { height: 1px !important; background: rgba(0,0,0,0.1) !important; width: 60% !important; margin: 0 auto 20px !important; }

/* TIMER */
.nye-timer-label { font-size: 0.7rem !important; font-weight: 800 !important; color: #888 !important; margin-bottom: 5px !important; }
.nye-timer { display: flex !important; justify-content: center !important; align-items: flex-end !important; gap: 8px !important; }
.t-val { font-family: var(--nye-font-head) !important; font-size: 2.8rem !important; line-height: 1 !important; font-weight: 600 !important; display: block !important; color: var(--nye-text) !important;}
.t-lbl { font-size: 0.6rem !important; font-weight: 700 !important; color: #999 !important; display: block !important; margin-top: -5px !important;}
.t-sep { font-family: var(--nye-font-head) !important; font-size: 2rem !important; color: #ccc !important; padding-bottom: 12px !important; }

/* --- VIDEO SECTION --- */
.nye-video-section {
  padding: 80px 20px 100px !important;
  background: #fff !important;
  border-top: 1px solid #eee !important;
  position: relative !important;
  z-index: 5 !important;
}
.nye-video-container {
  max-width: 1200px !important; margin: 0 auto !important;
  display: grid !important; grid-template-columns: 1fr 0.6fr !important;
  align-items: center !important; gap: 60px !important;
}
.nye-video-text { padding-right: 20px !important; }
.nye-video-title {
  font-family: var(--nye-font-head) !important; font-size: 3.5rem !important; 
  line-height: 1 !important; margin: 0 0 20px !important; color: var(--nye-text) !important;
}
.nye-video-quote {
  font-size: 1.4rem !important; line-height: 1.5 !important; font-style: italic !important;
  color: #444 !important; border-left: 4px solid var(--nye-red) !important;
  padding-left: 20px !important; margin-bottom: 20px !important;
}

.nye-video-wrapper {
  display: flex !important; justify-content: center !important;
}
.nye-phone-outer {
  width: 100% !important; 
  max-width: 320px !important; 
  background: #000 !important;
  border-radius: 24px !important;
  box-shadow: 0 20px 50px rgba(0,0,0,0.2) !important;
  border: 10px solid #000 !important;
  overflow: hidden !important;
  position: relative !important;
}

.nye-phone-screen {
  position: relative !important;
  width: 100% !important;
  padding-top: 177.77% !important; 
  background: #000 !important;
}

.nye-phone-screen iframe {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
}

/* BOTTOM DOCK */
.nye-dock {
  background: #fff !important; border-top: 4px solid var(--nye-red) !important;
  position: relative !important; z-index: 10 !important;
}
.nye-dock-grid {
  display: grid !important; grid-template-columns: repeat(4, 1fr) !important;
  max-width: 1600px !important; margin: 0 auto !important;
}
.nye-dock-card {
  padding: 2.5rem !important; text-align: center !important; text-decoration: none !important;
  border-right: 1px solid #eee !important; color: var(--nye-text) !important;
  transition: background 0.2s !important; display: block !important;
}
.nye-dock-card:hover { background: #f9f9f9 !important; }
.nye-dock-sub { 
  font-size: 0.8rem !important; color: var(--nye-red) !important; font-weight: 800 !important; 
  letter-spacing: 1px !important; margin-bottom: 10px !important; display: block !important;
}
.nye-dock-title { 
  font-family: var(--nye-font-head) !important; font-size: 2rem !important; line-height: 1 !important; 
  color: var(--nye-text) !important; display: block !important;
}

/* MOBILE OPTIMIZATION */
@media (max-width: 1024px) {
  .nye-bg-rings { top: 50% !important; left: 50% !important; width: 600px !important; height: 600px !important; }
  .nye-container { grid-template-columns: 1fr !important; gap: 30px !important; padding: 0 20px !important; }
  .nye-hero-section { padding: 40px 0 60px !important; }
  .nye-hero-text { align-items: center !important; text-align: center !important; }
  .nye-tagline { justify-content: center !important; }
  .nye-headline { font-size: 4.5rem !important; margin-bottom: 1.5rem !important; }
  .nye-slab { margin-left: 0 !important; transform-origin: center !important; }
  .nye-desc { border-left: none !important; border-top: 3px solid var(--nye-red) !important; padding: 15px 0 0 0 !important; margin: 0 auto 1.5rem !important; font-size: 1rem !important; }
  .nye-hud-card { padding: 25px 15px !important; margin-top: -10px !important; }
  .nye-hud-discount { font-size: 5rem !important; }
  .nye-video-container { grid-template-columns: 1fr !important; gap: 40px !important; text-align: center !important; }
  .nye-video-text { padding: 0 !important; }
  .nye-video-quote { border-left: none !important; padding: 0 !important; }
  .nye-dock-grid { grid-template-columns: 1fr !important; }
  .nye-dock-card { border-right: none !important; border-bottom: 1px solid #eee !important; padding: 1.5rem !important; text-align: left !important; display: flex !important; flex-direction: column !important; align-items: flex-start !important; }
}

/* ─────────────────────────────────────────────────────────────
   CELEBRATION BALLOONS (TWEAKED)
   ───────────────────────────────────────────────────────────── */
#im-balloon-container {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  pointer-events: none; /* Let clicks pass through */
  z-index: 9999;
  overflow: hidden;
}

.balloon {
  position: absolute;
  bottom: -150px; /* Start further down to account for bigger sizes */
  width: 50px;
  height: 65px;
  border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
  background-color: var(--color);
  box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1), inset 10px 10px 10px rgba(255,255,255,0.3);
  /* Faster base animation time (5s instead of 6s) */
  animation: floatUp 5s linear forwards, sway 2s ease-in-out infinite alternate;
}

/* Balloon String */
.balloon::before {
  content: '';
  position: absolute;
  bottom: -12px;
  left: 50%;
  transform: translateX(-50%);
  width: 1px;
  height: 40px;
  background: rgba(0,0,0,0.3);
}

/* Balloon Knot */
.balloon::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 6px solid var(--color);
}

@keyframes floatUp {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(-120vh) rotate(5deg); opacity: 0; }
}

@keyframes sway {
  0% { margin-left: -10px; }
  100% { margin-left: 10px; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // 1. COPY CODE LOGIC
  window.copyCode = function(code) {
    if(navigator.clipboard) {
      navigator.clipboard.writeText(code).then(showSuccess);
    } else {
      var input = document.createElement('textarea');
      input.value = code; document.body.appendChild(input); input.select();
      document.execCommand('copy'); document.body.removeChild(input);
      showSuccess();
    }
  };
  function showSuccess() {
    var status = document.getElementById('copyStatus');
    status.classList.add('visible');
    setTimeout(function() { status.classList.remove('visible'); }, 2000);
  }
  
  // 2. COUNTDOWN TIMER LOGIC
  var timerEl = document.getElementById('nye-timer');
  if(timerEl) {
    var endDateStr = timerEl.getAttribute('data-date');
    var endDate = new Date(endDateStr).getTime();
    if(!isNaN(endDate)) {
      var tick = setInterval(function() {
        var now = new Date().getTime();
        var distance = endDate - now;
        if (distance < 0) {
          clearInterval(tick);
          return;
        }
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var totalHours = (days * 24) + hours;
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        document.getElementById('t-hours').innerText = totalHours < 10 ? "0" + totalHours : totalHours;
        document.getElementById('t-minutes').innerText = minutes < 10 ? "0" + minutes : minutes;
        document.getElementById('t-seconds').innerText = seconds < 10 ? "0" + seconds : seconds;
      }, 1000);
    }
  }

  // 3. CELEBRATION BALLOONS (Runs once on load)
  createBalloons();

  function createBalloons() {
    const container = document.getElementById('im-balloon-container');
    const colors = ['#D11F1F', '#D4AF37', '#ffffff', '#000000', '#D11F1F']; // Red, Gold, White, Black
    const balloonCount = 50; 

    for (let i = 0; i < balloonCount; i++) {
      const balloon = document.createElement('div');
      balloon.classList.add('balloon');
      
      // Random Attributes
      const bg = colors[Math.floor(Math.random() * colors.length)];
      const left = Math.floor(Math.random() * 100); // 0-100%
      
      // FASTER SPEED: Random duration between 2.5s and 4.5s
      const duration = Math.random() * 2 + 2.5; 
      
      const delay = Math.random() * 3; // 0-3s delay start
      
      // BIGGER SIZES: Scale from 0.8x up to 2.2x normal size
      const sizeScale = 0.8 + Math.random() * 1.4; 

      balloon.style.setProperty('--color', bg);
      balloon.style.left = left + 'vw';
      balloon.style.animationDuration = duration + 's, 2s'; // Float, Sway
      balloon.style.animationDelay = delay + 's, 0s';
      balloon.style.transform = `scale(${sizeScale})`;
      
      container.appendChild(balloon);
    }

    // CLEANUP: Remove container faster (6 seconds total lifecycle)
    setTimeout(() => {
      container.remove();
    }, 6000); 
  }
});
</script>

{% schema %}
{
  "name": "[ICON] NYE Flash Sale",
  "settings": [
    { "type": "header", "content": "Text Content" },
    { "type": "text", "id": "tagline_v2", "label": "Tagline", "default": "DAY 1 OF 365" },
    { "type": "text", "id": "headline_v2_1", "label": "Headline Line 1", "default": "GLOVES OFF." },
    { "type": "text", "id": "headline_v2_2", "label": "Headline Line 2", "default": "2026 IS HERE." },
    { "type": "textarea", "id": "description_v2", "label": "Description", "default": "The countdown is over. The resolutions are set. Now the real work begins. Stop guessing and start executing with the ultimate fuel." },
    { "type": "text", "id": "cta_text_v2", "label": "Button Text", "default": "FUEL THE MISSION" },
    { "type": "url", "id": "cta_link_v2", "label": "Button Link (Auto-Apply)" },
    
    { "type": "header", "content": "Offer Configuration" },
    { "type": "text", "id": "discount_amount_v2", "label": "Discount %", "default": "31% OFF" },
    { "type": "text", "id": "discount_code_v2", "label": "Discount Code", "default": "NYE31" },
    { "type": "text", "id": "end_date_v2", "label": "End Date", "default": "Jan 1, 2026 23:59:59" },

    { "type": "header", "content": "Bottom Dock Navigation" },
    { "type": "text", "id": "nav_1_sub", "label": "Link 1 Sub", "default": "THE MENU" },
    { "type": "text", "id": "nav_1_title", "label": "Link 1 Title", "default": "SIGNATURE MEALS" },
    { "type": "url", "id": "nav_1_link", "label": "Link 1 URL" },

    { "type": "text", "id": "nav_2_sub", "label": "Link 2 Sub", "default": "BUILD YOUR OWN" },
    { "type": "text", "id": "nav_2_title", "label": "Link 2 Title", "default": "CUSTOM BUILDER" },
    { "type": "url", "id": "nav_2_link", "label": "Link 2 URL" },

    { "type": "text", "id": "nav_3_sub", "label": "Link 3 Sub", "default": "BY THE POUND" },
    { "type": "text", "id": "nav_3_title", "label": "Link 3 Title", "default": "BULK ITEMS" },
    { "type": "url", "id": "nav_3_link", "label": "Link 3 URL" },

    { "type": "text", "id": "nav_4_sub", "label": "Link 4 Sub", "default": "CURATED BOXES" },
    { "type": "text", "id": "nav_4_title", "label": "Link 4 Title", "default": "MEAL PLANS" },
    { "type": "url", "id": "nav_4_link", "label": "Link 4 URL" }
  ],
  "presets": [ { "name": "[ICON] NYE Flash Sale" } ]
}
{% endschema %}
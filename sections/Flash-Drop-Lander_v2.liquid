{% comment %}
=====================================================================================
  Shopify Section: Flash-Drop Lander
  Version: 16.3 (Desktop Polish & Refinement)
  Author: AI Lead Developer

  **V16.3 Revisions & Rationale:**
  - **Added Vertical Divider:** A subtle 1px vertical line was added between the two columns on desktop to improve separation and visual structure, preventing a "clustered" look.
  - **Symmetrical Padding:** Adjusted the top and bottom padding of the hero section on desktop to be equal, creating a more balanced and aesthetically pleasing frame.
  - **Updated Default Content:** The default product title and ingredients were updated to match the "Shredded Chicken & Egg Bowl" example for consistency.
  - **Preserved V16.2 Layout:** Maintained the balanced two-column desktop structure and the untouched mobile layout from the previous revision.
=====================================================================================
{% endcomment %}

<!-- Fonts for Headline & Timer -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">

{%- liquid
  assign product = section.settings.featured_product
  if product == blank
    assign show_placeholder = true
    assign original_price = 0
  else
    assign show_placeholder = false
    assign original_price = product.price
  endif

  assign sale_price_fixed = 850
-%}

<div
  class="flash-drop"
  data-section-id="{{ section.id }}"
  data-sale-price="{{ sale_price_fixed }}"
>

  <!-- =======================
  1. HERO SECTION
  ======================== -->
  <header class="flash-drop__hero">
    <div class="flash-drop__container">
      <div class="flash-drop__hero-grid">

        <!-- Right Column Container (Image + Details on Desktop) -->
        <div class="flash-drop__hero-right-col">
          <div class="flash-drop__hero-image-wrapper">
            {%- if show_placeholder -%}
              {{ 'product-2' | placeholder_svg_tag: 'flash-drop__hero-image flash-drop__hero-image--placeholder' }}
            {%- else -%}
              <img
                src="{{ product.featured_image | image_url: width: 1200 }}"
                alt="Glamour shot of {{ product.title | default: 'Shredded Chicken & Egg Bowl' }}"
                class="flash-drop__hero-image"
                loading="eager"
                width="600"
                height="600"
                style="max-width: 100%; height: auto;"
              >
            {%- endif -%}
            <div class="flash-drop__hero-badge">Ships Chilled</div>
          </div>

          <!-- Product Details for DESKTOP View -->
          <div class="flash-drop__product-details--desktop">
            {%- if show_placeholder == false -%}
              <div class="flash-drop__macros">
                <div class="flash-drop__macros-grid">
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.calories | default: '640' }}</span>
                    <span class="flash-drop__macro-label">Calories</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.protein_g | default: '53g' }}</span>
                    <span class="flash-drop__macro-label">Protein</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.carbs_g | default: '45g' }}</span>
                    <span class="flash-drop__macro-label">Carbs</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.fat_g | default: '28g' }}</span>
                    <span class="flash-drop__macro-label">Fats</span>
                  </div>
                </div>
              </div>
              <p class="flash-drop__ingredients">
                <strong>Shredded Bowl:</strong> {{ product.metafields.custom.main_ingredients | default: 'Pulled Chicken Breast, Thick Sliced Bacon, Roasted Red Potatoes, Scrambled Eggs, Cheddar Cheese, Black Beans.' }}
              </p>
              <button type="button" class="flash-drop__modal-trigger" data-modal-trigger="ingredients-modal">See Full Ingredients</button>
            {%- endif -%}
          </div>
        </div>

        <!-- Left Column Container (Content) -->
        <div class="flash-drop__hero-content">
          {%- if show_placeholder -%}
            <h1 class="flash-drop__h1">Select a Product</h1>
            <div class="flash-drop__h1-suboffer-wrapper">
              <p class="flash-drop__h1-suboffer">To See The Live Offer</p>
            </div>
          {%- else -%}
            <h1 class="flash-drop__h1">{{ product.title | default: 'Shredded Chicken & Egg Bowl' }}</h1>
            <div class="flash-drop__h1-suboffer-wrapper">
              <p class="flash-drop__h1-suboffer">$8.50 Today Only</p>
            </div>
          {%- endif -%}

          <p class="flash-drop__subhead">{{ section.settings.hero_subhead }}</p>

          <!-- Product Details for MOBILE View -->
          <div class="flash-drop__product-details--mobile">
            {%- if show_placeholder == false -%}
              <div class="flash-drop__macros">
                <div class="flash-drop__macros-grid">
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.calories | default: '640' }}</span>
                    <span class="flash-drop__macro-label">Calories</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.protein_g | default: '53g' }}</span>
                    <span class="flash-drop__macro-label">Protein</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.carbs_g | default: '45g' }}</span>
                    <span class="flash-drop__macro-label">Carbs</span>
                  </div>
                  <div class="flash-drop__macro-item">
                    <span class="flash-drop__macro-value">{{ product.metafields.custom.fat_g | default: '28g' }}</span>
                    <span class="flash-drop__macro-label">Fats</span>
                  </div>
                </div>
              </div>
              <p class="flash-drop__ingredients">
                <strong>Shredded Bowl:</strong> {{ product.metafields.custom.main_ingredients | default: 'Pulled Chicken Breast, Thick Sliced Bacon, Roasted Red Potatoes, Scrambled Eggs, Cheddar Cheese, Black Beans.' }}
              </p>
              <button type="button" class="flash-drop__modal-trigger" data-modal-trigger="ingredients-modal">See Full Ingredients</button>
            {%- endif -%}
          </div>

          <div class="flash-drop__price-block">
            {%- if show_placeholder -%}
              <span class="flash-drop__price-strikethrough">$XX.XX</span>
              <span class="flash-drop__price-sale">$8.50</span>
            {%- else -%}
               <span class="flash-drop__price-strikethrough">{{ original_price | money }}</span>
               <span class="flash-drop__price-sale">{{ sale_price_fixed | money }}</span>
            {%- endif -%}
          </div>

          <form class="flash-drop__purchase-form" data-purchase-form novalidate>
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <div class="flash-drop__hero-purchase-wrapper">
              <div class="flash-drop__timer">
                <p class="flash-drop__timer-label">Offer ends in:</p>
                <div class="flash-drop__timer-countdown" data-timer-container>
                  <span data-hours>00</span>:<span data-minutes>00</span>:<span data-seconds>00</span>
                </div>
              </div>

              <div class="flash-drop__hero-quantity">
                <p class="flash-drop__quantity-label">QTY (Limit 4)</p>
                <div class="flash-drop__quantity-selector">
                  <button type="button" class="flash-drop__quantity-btn" data-quantity-minus aria-label="Decrease quantity">-</button>
                  <input
                    class="flash-drop__quantity-input"
                    type="number"
                    name="quantity"
                    value="1"
                    min="1"
                    max="4"
                    aria-label="Quantity"
                    data-quantity-input
                  >
                  <button type="button" class="flash-drop__quantity-btn" data-quantity-plus aria-label="Increase quantity">+</button>
                </div>
              </div>
            </div>

            <div class="flash-drop__cta-wrapper">
              <button type="submit" class="flash-drop__cta flash-drop__cta--submit" data-add-to-cart-button>
                Add to Cart
              </button>
              <a href="{{ collections['signature-menu'].url | default: routes.all_products_collection_url }}" class="flash-drop__cta flash-drop__cta--continue" data-continue-shopping-button>
                Continue to Signature Menu
              </a>
            </div>
            <div class="flash-drop__form-feedback" data-form-feedback aria-live="polite"></div>
          </form>

        </div>
      </div>
    </div>
  </header>

  <main class="flash-drop__main-content">
    <!-- =======================
    VIDEO PROOF SECTION
    ======================== -->
    {%- if section.settings.youtube_video_url != blank -%}
      {%- assign video_id = section.settings.youtube_video_url | split: '/' | last -%}
      <section class="flash-drop__section">
        <div class="flash-drop__container flash-drop__container--narrow">
          <h2 class="flash-drop__section-title">USDA Inspected. Cooked In-House</h2>
          <div class="flash-drop__video-wrapper">
            <iframe
              src="https://www.youtube.com/embed/{{ video_id }}?autoplay=1&mute=1&controls=0&loop=1&playlist={{ video_id }}&rel=0&modestbranding=1"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              title="Product Video"
              class="flash-drop__video-iframe"
            ></iframe>
          </div>
        </div>
      </section>
    {%- endif -%}

    <!-- =======================
    NEXT STEPS / CATEGORY GRID (NEW)
    ======================== -->
    <section class="flash-drop__section flash-drop__section--categories">
      <div class="flash-drop__container">
        <h2 class="flash-drop__section-title">What's Next? Shop Your Way</h2>
        <div class="fd-category-grid">
          
          <!-- Category Card 1: Signature Meals -->
          <a href="/collections/signature-menu" class="category-card">
            <div class="category-card__image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/1957/2713/files/Signature-Meals_v1.jpg?v=1750349495" loading="lazy" alt="A delicious, healthy plated signature meal from ICON Meals.">
            </div>
            <div class="category-card__content">
              <h3>Signature Meals</h3>
              <p>30+ chef-curated recipes ready in 90 seconds. Maximum flavor, perfect macros, zero guesswork.</p>
              <span class="category-card__button">Shop Signature â†’</span>
            </div>
          </a>

          <!-- Category Card 2: Custom Meals -->
          <a href="/pages/custom-meals" class="category-card">
            <div class="category-card__image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/1957/2713/files/Custom-Meals_v1.jpg?v=1750349495" loading="lazy" alt="An overhead view of healthy ingredients like salmon, chicken, broccoli, and rice for custom meals.">
            </div>
            <div class="category-card__content">
              <h3>Custom Meals</h3>
              <p>You are in complete control. Choose your proteins, carbs, and veggies to build the exact meal you need.</p>
              <span class="category-card__button">Build Your Own â†’</span>
            </div>
          </a>

          <!-- Category Card 3: Meal Boxes -->
          <a href="/collections/meal-boxes" class="category-card">
            <div class="category-card__image-wrapper">
              <img src="https://iconmeals.com/cdn/shop/files/build-your-box_900x.jpg?v=1654193516" loading="lazy" alt="An open ICON Meals box for building your own variety pack of meals.">
            </div>
            <div class="category-card__content">
              <h3>Meal Boxes</h3>
              <p>The best value and variety. Curated boxes packed with our most popular meals to fuel your week.</p>
              <span class="category-card__button">Shop Boxes â†’</span>
            </div>
          </a>

          <!-- Category Card 4: Bulk Items -->
          <a href="/collections/by-the-pound" class="category-card">
            <div class="category-card__image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/1957/2713/files/Bulk-Meals_v1.jpg?v=1750349495" loading="lazy" alt="Perfectly cooked and sliced steak, a bulk item from ICON Meals.">
            </div>
            <div class="category-card__content">
              <h3>Bulk Items</h3>
              <p>Perfectly cooked proteins and sides by the pound. The ultimate meal-prep shortcut for athletes.</p>
              <span class="category-card__button">Shop Bulk â†’</span>
            </div>
          </a>

        </div>
      </div>
    </section>

  </main>

  <!-- =======================
  FULL INGREDIENTS MODAL
  ======================== -->
  <div class="flash-drop__modal" id="ingredients-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="flash-drop__modal-overlay" data-modal-close></div>
    <div class="flash-drop__modal-content">
      <button class="flash-drop__modal-close-btn" data-modal-close aria-label="Close modal">Ã—</button>
      <h2 class="flash-drop__modal-title" id="modal-title">Full Ingredients</h2>
      {%- if product.metafields.custom.full_ingredients_html != blank -%}
        <div class="flash-drop__modal-body">
          {{ product.metafields.custom.full_ingredients_html }}
        </div>
      {%- else -%}
        <div class="flash-drop__modal-body">
          <h3>Main Ingredients</h3>
          <ul>
            <li>Chicken Breast (boneless, skinless, with rib meat)</li>
            <li>Cheddar Cheese (shredded)</li>
            <li>Low Sodium Black Beans</li>
            <li>Red Potatoes (diced)</li>
            <li>
              Eggs
              <div class="flash-drop__sub-ingredients">
                Whole liquid eggs (with citric acid)<br>
                Liquid egg whites (with whipping aids)
              </div>
            </li>
            <li>
              Applewood Smoked Bacon
              <div class="flash-drop__sub-ingredients">
                Pork, Water, Salt, Sugar, Cultured Celery Powder, Sea Salt, Natural Flavoring
              </div>
            </li>
            <li>
              Monterey Jack Cheese with JalapeÃ±os
              <div class="flash-drop__sub-ingredients">
                Pasteurized Milk, JalapeÃ±o Peppers, Cheese Culture, Salt, Enzymes, Potato Starch, Powdered Cellulose, Natamycin
              </div>
            </li>
          </ul>

          <h3>ðŸ§‚ Supporting Ingredients</h3>
          <ul>
            <li>Fresh Parsley</li>
            <li>Onion Powder</li>
            <li>Granulated Garlic</li>
            <li>Paprika (with anti-caking agent)</li>
            <li>Ground Black Pepper</li>
            <li>Light Chili Powder</li>
            <li>Kosher Salt (with yellow prussiate of soda)</li>
            <li>Italian Seasoning (marjoram, thyme, rosemary, savory, sage, oregano, basil)</li>
            <li>Extra Virgin Olive Oil</li>
          </ul>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
:root {
  --fd-color-text: #2d3748;
  --fd-color-text-light: #4a5568;
  --fd-color-heading: #1a202c;
  --fd-color-background: #ffffff;
  --fd-color-background-alt: #f7fafc;
  --fd-color-border: #e2e8f0;
  --fd-color-primary: {{ settings.color_accent | default: '#CD1C26' }};
  --fd-color-accent: {{ settings.color_button | default: '#FFD000' }};
  --fd-font-hero: 'Archivo Black', sans-serif;
  --fd-font-body: {{ settings.body_font.family | default: 'sans-serif' }};
  --fd-font-timer: 'Roboto Mono', monospace;
  --fd-shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07);
  --fd-shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
  --fd-radius: 8px;
  --fd-radius-lg: 0.75rem;
}
@keyframes fd-shimmer {
  0% { transform: translateX(-150%) skewX(-25deg); }
  25% { transform: translateX(150%) skewX(-25deg); }
  100% { transform: translateX(150%) skewX(-25deg); }
}

.flash-drop { font-family: var(--fd-font-body); color: var(--fd-color-text); background-color: var(--fd-color-background); }
.flash-drop__container { max-width: 1100px; width: 90%; margin: 0 auto; }
.flash-drop__container--narrow { max-width: 720px; }

/* --- 1. Hero Section --- */
.flash-drop__hero { background: var(--fd-color-background-alt); padding: 2rem 0 4rem; overflow: hidden; }
.flash-drop__hero-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; align-items: center; }
.flash-drop__hero-content { text-align: center; }
.flash-drop__h1 { font-family: var(--fd-font-hero); font-size: clamp(2.5rem, 9vw, 4rem); line-height: 1.1; color: var(--fd-color-heading); text-transform: uppercase; margin: 0; text-wrap: balance; }
.flash-drop__h1-suboffer-wrapper { display: inline-block; background-color: var(--fd-color-accent); padding: 0.25rem 1rem; border-radius: var(--fd-radius); margin: 0.75rem 0 1.5rem; }
.flash-drop__h1-suboffer {
  font-family: var(--fd-font-hero);
  font-size: clamp(1.75rem, 6vw, 2.75rem);
  line-height: 1.1;
  color: var(--fd-color-heading);
  text-transform: uppercase;
  margin: 0;
  text-wrap: balance;
}
.flash-drop__subhead { font-size: clamp(1rem, 2.5vw, 1.15rem); margin: 0 auto 1.5rem; max-width: 50ch; }
.flash-drop__macros { margin: 0 auto 2rem; max-width: 500px; }
.flash-drop__macros-grid { display: flex; flex-wrap: wrap; justify-content: center; border: 1px solid var(--fd-color-border); border-radius: var(--fd-radius); overflow: hidden; background-color: white; }
.flash-drop__macro-item { flex: 1; min-width: 70px; padding: 0.75rem 0.5rem; text-align: center; }
.flash-drop__macro-item:not(:last-child) { border-right: 1px solid var(--fd-color-border); }
.flash-drop__macro-value { display: block; font-weight: 700; font-size: 1.25rem; line-height: 1.2; color: var(--fd-color-heading); }
.flash-drop__macro-label { font-size: 0.75rem; opacity: 0.8; }
.flash-drop__ingredients { font-size: 0.9rem; margin: 1rem 0 0; line-height: 1.5; color: var(--fd-color-text); }
.flash-drop__modal-trigger { background: none; border: none; padding: 0; font-size: 0.9rem; text-decoration: underline; cursor: pointer; color: var(--fd-color-heading); margin-top: 0.5rem; }
.flash-drop__price-block { margin: 2rem auto; display: flex; align-items: center; justify-content: center; gap: 1rem; flex-wrap: wrap; }
.flash-drop__price-strikethrough { font-size: 1.5rem; text-decoration: line-through; opacity: 0.7; }
.flash-drop__price-sale { font-size: 2.5rem; font-weight: 700; color: var(--fd-color-primary); }
.flash-drop__hero-purchase-wrapper { display: flex; flex-wrap: nowrap; gap: 1rem; align-items: stretch; justify-content: center; margin: 0 auto 1.5rem; max-width: 400px; }
.flash-drop__timer, .flash-drop__hero-quantity { background-color: var(--fd-color-background); border: 1px solid var(--fd-color-border); padding: 0.75rem 1rem; border-radius: var(--fd-radius); flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
.flash-drop__timer-label, .flash-drop__quantity-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 0.25rem; text-align: center; }
.flash-drop__timer-countdown { font-family: var(--fd-font-timer); font-size: 2rem; font-weight: 700; color: var(--fd-color-heading); text-align: center; }
.flash-drop__timer-ended { font-family: var(--fd-font-timer); font-size: 1.5rem; color: var(--fd-color-primary); text-align: center;}
.flash-drop__quantity-selector { display: flex; justify-content: center; align-items: center; }
.flash-drop__quantity-btn { width: 36px; height: 36px; border: 1px solid var(--fd-color-border); background-color: #fff; font-size: 1.25rem; cursor: pointer; line-height: 1; transition: background-color 0.2s; border-radius: 0; }
.flash-drop__quantity-btn:hover:not(:disabled) { background-color: var(--fd-color-background-alt); }
.flash-drop__quantity-btn:first-child { border-radius: var(--fd-radius) 0 0 var(--fd-radius); }
.flash-drop__quantity-btn:last-child { border-radius: 0 var(--fd-radius) var(--fd-radius) 0; }
.flash-drop__quantity-input { width: 40px; height: 36px; text-align: center; font-size: 1.25rem; font-weight: 700; border: 1px solid var(--fd-color-border); border-left: none; border-right: none; -moz-appearance: textfield; }
.flash-drop__quantity-input::-webkit-outer-spin-button, .flash-drop__quantity-input::-webkit-inner-spin-button { margin: 0; }
.flash-drop__quantity-btn:disabled { background-color: #f9f9f9; cursor: not-allowed; opacity: 0.5; }
.flash-drop__cta-wrapper { position: relative; max-width: 400px; margin: 0 auto; }
.flash-drop__cta { position: relative; overflow: hidden; display: block; width: 100%; background-color: var(--fd-color-primary) !important; color: white !important; padding: 1rem 2rem; border-radius: var(--fd-radius); font-weight: 700; font-size: 1.1rem; text-decoration: none !important; text-align: center; border: 2px solid transparent; transition: all 0.3s ease-in-out, opacity 0.3s ease; }
.flash-drop__cta::after { content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%); pointer-events: none; }
.flash-drop__cta--submit:not(.is-adding):not(.is-added)::after { animation: fd-shimmer 4s ease-in-out infinite; }
.flash-drop__cta:hover { transform: scale(1.05); }
.flash-drop__cta--submit:hover { background-color: var(--fd-color-accent) !important; color: var(--fd-color-heading) !important; }
.flash-drop__cta--submit.is-added { background-color: #28a745 !important; color: white !important; cursor: default; }
.flash-drop__cta--submit.is-added:hover { transform: none; }
.flash-drop__cta--continue { margin-top: 1rem; background-color: var(--fd-color-heading) !important; position: absolute; top: 0; left: 0; opacity: 0; visibility: hidden; }
.flash-drop__cta-wrapper.is-swapped .flash-drop__cta--submit { opacity: 0; visibility: hidden; }
.flash-drop__cta-wrapper.is-swapped .flash-drop__cta--continue { position: static; opacity: 1; visibility: visible; }
.flash-drop__form-feedback { min-height: 1.2em; font-size: 0.8rem; font-weight: bold; margin-top: 0.75rem; text-align: center; }
.flash-drop__hero-image-wrapper { position: relative; }
.flash-drop__hero-image { width: 100%; height: auto; max-width: 100%; object-fit: contain; border-radius: var(--fd-radius); }
.flash-drop__hero-badge { position: absolute; bottom: 1rem; right: 1rem; background-color: rgba(255, 255, 255, 0.9); color: var(--fd-color-heading); padding: 0.5rem 1rem; border-radius: calc(var(--fd-radius) / 2); font-size: 0.9rem; font-weight: 700; backdrop-filter: blur(4px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.flash-drop__product-details--desktop { display: none; }

@media (min-width: 992px) {
  .flash-drop__hero {
    padding: 5rem 0; /* POLISH: Symmetrical vertical padding on desktop */
  }
  .flash-drop__hero-grid {
    grid-template-columns: 1fr 1fr;
    align-items: start;
    gap: 4rem; /* POLISH: Increased gap to accommodate divider */
  }
  .flash-drop__hero-right-col {
    position: relative; /* POLISH: For positioning the divider */
  }
  /* POLISH: Vertical Divider Style */
  .flash-drop__hero-right-col::before {
    content: '';
    position: absolute;
    left: -2rem; /* Half of the grid-gap */
    top: 0;
    width: 1px;
    height: 100%;
    background-color: var(--fd-color-border);
  }
  .flash-drop__hero-content { order: -1; text-align: left; }
  .flash-drop__subhead { margin-left: 0; margin-right: 0; text-align: left; }
  .flash-drop__h1-suboffer-wrapper { margin-left: 0; margin-right: 0; }
  .flash-drop__price-block { margin-left: 0; margin-right: 0; justify-content: flex-start; }
  .flash-drop__hero-purchase-wrapper { justify-content: flex-start; max-width: none; }
  .flash-drop__cta-wrapper { margin-left: 0; margin-right: 0; }
  .flash-drop__form-feedback { text-align: left; }
  
  .flash-drop__product-details--mobile { display: none; }
  .flash-drop__product-details--desktop { display: block; margin-top: 2rem; text-align: left; }
  .flash-drop__product-details--desktop .flash-drop__macros { margin: 0 0 1.5rem 0; }
  .flash-drop__product-details--desktop .flash-drop__macros-grid { justify-content: flex-start; }
  .flash-drop__product-details--desktop .flash-drop__ingredients { margin-top: 0; }
}

/* --- Shared Section Styles --- */
.flash-drop__section { padding: 4rem 0; }
.flash-drop__section:not(.flash-drop__section--categories) { border-top: 1px solid var(--fd-color-border); }
.flash-drop__section--categories { background-color: var(--fd-color-background-alt); }
.flash-drop__section-title { font-family: var(--fd-font-hero); font-size: clamp(2rem, 5vw, 2.75rem); text-align: center; margin: 0 auto 3rem; color: var(--fd-color-heading); line-height: 1.2; text-wrap: balance; }

/* --- Video Section --- */
.flash-drop__video-wrapper { position: relative; width: 100%; padding-bottom: 177.77%; height: 0; overflow: hidden; border-radius: var(--fd-radius); box-shadow: var(--fd-shadow-md); background-color: #000; }
.flash-drop__video-iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }

/* --- Category Grid (NEW) --- */
.fd-category-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
@media(min-width: 768px) { .fd-category-grid { grid-template-columns: repeat(2, 1fr); gap: 2.5rem; } }
.category-card { display: flex; flex-direction: column; background-color: var(--fd-color-background); border: 1px solid var(--fd-color-border); border-radius: var(--fd-radius-lg); text-decoration: none !important; overflow: hidden; box-shadow: var(--fd-shadow-md); transition: transform 0.3s ease, box-shadow 0.3s ease; }
.category-card:hover { transform: translateY(-10px); box-shadow: var(--fd-shadow-lg); }
.category-card__image-wrapper { width: 100%; aspect-ratio: 16/10; overflow: hidden; }
.category-card__image-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
.category-card:hover .category-card__image-wrapper img { transform: scale(1.05); }
.category-card__content { padding: 1.5rem; display: flex; flex-direction: column; flex-grow: 1; text-align: left; }
.category-card h3 { font-family: var(--fd-font-hero); font-size: 1.5rem; color: var(--fd-color-heading) !important; margin: 0 0 0.5rem 0; }
.category-card p { color: var(--fd-color-text-light); line-height: 1.5; margin: 0; }
.category-card__button { display: inline-block; background-color: var(--fd-color-primary); color: white !important; padding: 0.75rem 1.5rem; border-radius: var(--fd-radius); text-align: center; font-weight: 700; margin-top: 1.5rem; transition: all 0.25s ease; transform: scale(1); }
.category-card:hover .category-card__button { background-color: var(--fd-color-accent) !important; color: var(--fd-color-heading) !important; transform: scale(1.05); }

/* --- Ingredients Modal --- */
.flash-drop__modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s 0.3s; }
.flash-drop__modal.is-visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease; }
.flash-drop__modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); cursor: pointer; }
.flash-drop__modal-content { position: relative; background: white; padding: 2rem; border-radius: var(--fd-radius); max-width: 90%; width: 600px; max-height: 80vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
.flash-drop__modal.is-visible .flash-drop__modal-content { transform: scale(1); }
.flash-drop__modal-close-btn { position: absolute; top: 0.5rem; right: 0.75rem; background: none; border: none; font-size: 2rem; color: var(--fd-color-text); cursor: pointer; line-height: 1; }
.flash-drop__modal-title { margin: 0 0 1.5rem; font-family: var(--fd-font-hero); font-size: 1.75rem; }
.flash-drop__modal-body h3 { font-family: var(--fd-font-hero); margin: 1.5rem 0 0.5rem; font-size: 1.2rem; }
.flash-drop__modal-body ul { list-style-type: none; padding-left: 0; margin: 0; }
.flash-drop__modal-body li { padding: 0.25rem 0; line-height: 1.5; }
.flash-drop__sub-ingredients { font-size: 0.9em; opacity: 0.8; margin: 0.25rem 0 0.5rem 1.25rem; padding: 0; border-left: none !important; background: none !important; font-style: normal !important; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sectionId = {{ section.id | json }};
  const flashDrop = document.querySelector(`.flash-drop[data-section-id="${sectionId}"]`);
  if (!flashDrop) return;

  // --- Purchase Logic ---
  const purchaseForm = flashDrop.querySelector('[data-purchase-form]');
  if(purchaseForm) {
    const quantityInput = purchaseForm.querySelector('[data-quantity-input]');
    const maxQuantity = parseInt(quantityInput.max, 10);
    const plusBtn = purchaseForm.querySelector('[data-quantity-plus]');
    const minusBtn = purchaseForm.querySelector('[data-quantity-minus]');
    const atcButton = purchaseForm.querySelector('[data-add-to-cart-button]');
    const ctaWrapper = atcButton.closest('.flash-drop__cta-wrapper');
    const feedbackEl = purchaseForm.querySelector('[data-form-feedback]');

    function updateButtonState() {
      const quantity = parseInt(quantityInput.value, 10);
      minusBtn.disabled = quantity <= 1;
      plusBtn.disabled = quantity >= maxQuantity;
    }

    plusBtn.addEventListener('click', () => { if (parseInt(quantityInput.value) < maxQuantity) { quantityInput.stepUp(); updateButtonState(); }});
    minusBtn.addEventListener('click', () => { if (parseInt(quantityInput.value) > 1) { quantityInput.stepDown(); updateButtonState(); }});
    quantityInput.addEventListener('input', () => {
        if(parseInt(quantityInput.value) > maxQuantity) quantityInput.value = maxQuantity;
        if(parseInt(quantityInput.value) < 1 || isNaN(parseInt(quantityInput.value))) quantityInput.value = 1;
        updateButtonState();
    });
    updateButtonState();

    purchaseForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      atcButton.disabled = true;
      atcButton.classList.add('is-adding');
      atcButton.textContent = 'Adding...';
      feedbackEl.textContent = '';

      const formData = new FormData(purchaseForm);
      try {
        const res = await fetch(window.Shopify.routes.root + 'cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ items: [{ id: formData.get('id'), quantity: formData.get('quantity') }] })
        });
        const cartData = await res.json();
        if (!res.ok) throw new Error(cartData.description || 'Could not add item.');

        atcButton.classList.remove('is-adding');
        atcButton.textContent = 'Add to Cart';
        atcButton.classList.add('is-added');

        if (ctaWrapper) {
          ctaWrapper.classList.add('is-swapped');
        }

        const cartNotification = document.querySelector('cart-notification');
        if (cartNotification) cartNotification.renderContents(cartData);
        const cartDrawer = document.querySelector('cart-drawer');
        if (cartDrawer) cartDrawer.renderContents(cartData);

      } catch (error) {
        feedbackEl.textContent = error.message;
        atcButton.disabled = false;
        atcButton.classList.remove('is-adding');
        atcButton.textContent = 'Add to Cart';
      }
    });
  }

  // --- Timer Logic ---
  const timerContainer = flashDrop.querySelector('[data-timer-container]');
  if(timerContainer) {
    const hoursEl = timerContainer.querySelector('[data-hours]');
    const minutesEl = timerContainer.querySelector('[data-minutes]');
    const secondsEl = timerContainer.querySelector('[data-seconds]');

    const setupCountdown = () => {
      const interval = setInterval(() => {
        const now = new Date();
        const endOfDay = new Date();
        endOfDay.setHours(23, 59, 59, 999);
        const distance = endOfDay.getTime() - now.getTime();

        if (distance < 0) {
          clearInterval(interval);
          timerContainer.innerHTML = '<span class="flash-drop__timer-ended">Offer Ended</span>';
          return;
        }
        const h = String(Math.floor(distance / (1000 * 60 * 60))).padStart(2, '0');
        const m = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
        const s = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2, '0');

        if(hoursEl) hoursEl.textContent = h;
        if(minutesEl) minutesEl.textContent = m;
        if(secondsEl) secondsEl.textContent = s;
      }, 1000);
    };
    setupCountdown();
  }

  // --- Modal Logic ---
  const modalTriggers = flashDrop.querySelectorAll('[data-modal-trigger]');
  modalTriggers.forEach(trigger => {
    trigger.addEventListener('click', function() {
      const modalId = this.dataset.modalTrigger;
      const modal = document.getElementById(modalId);
      if(modal) {
        modal.classList.add('is-visible');
        document.body.style.overflow = 'hidden';
      }
    });
  });

  const closeTriggers = flashDrop.querySelectorAll('[data-modal-close]');
  closeTriggers.forEach(trigger => {
    trigger.addEventListener('click', function() {
      const modal = this.closest('.flash-drop__modal');
      if(modal) {
        modal.classList.remove('is-visible');
        document.body.style.overflow = '';
      }
    });
  });

  window.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      const visibleModal = flashDrop.querySelector('.flash-drop__modal.is-visible');
      if (visibleModal) {
        visibleModal.classList.remove('is-visible');
        document.body.style.overflow = '';
      }
    }
  });
});
</script>

{% schema %}
{
  "name": "Flash-Drop (SC&EB)",
  "tag": "section",
  "class": "shopify-section--flash-drop-lander",
  "settings": [
    {
      "type": "header",
      "content": "Daily Meal Configuration"
    },
    {
      "type": "product",
      "id": "featured_product",
      "label": "Today's Featured Meal"
    },
    {
      "type": "url",
      "id": "youtube_video_url",
      "label": "YouTube Shorts URL",
      "info": "Paste the full YouTube Shorts URL here (e.g., https://www.youtube.com/shorts/your_video_id)."
    },
    {
      "type": "header",
      "content": "Page Content"
    },
    {
      "type": "text",
      "id": "hero_subhead",
      "label": "Hero Subheadline",
      "default": "Only cooking so many. First come, first served."
    }
  ],
  "presets": [
    {
      "name": "Flash-Drop (SC&EB)"
    }
  ]
}
{% endschema %}
{% comment %}
=====================================================================================
  CUSTOM MEAL PLAN GRID SECTION
  Designed for ICON Meals by your AI Assistant
  Version: 12.1 - The Definitive Final Version.
  - Fixed subtitle centering bug by applying auto margins for perfect alignment.
  - All previous world-class responsive refinements are included.
=====================================================================================
{% endcomment %}

<style>
  /* --- Section Wrapper & Header (Unchanged) --- */
  .meal-plan-section-wrapper { padding: 40px 0; background-color: #f8f9fa; }
  @media (min-width: 768px) { .meal-plan-section-wrapper { padding: 60px 0; } }
  .meal-plan-section-header { text-align: center; margin-bottom: 40px; }
  @media (min-width: 768px) { .meal-plan-section-header { margin-bottom: 50px; } }
  .meal-plan-section-header__subheading { font-size: 1rem; font-weight: 600; color: #d42828; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
  .meal-plan-section-header__heading { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important; font-size: 2.5rem !important; font-weight: 800 !important; line-height: 1.2 !important; margin: 0 !important; color: #212529 !important; letter-spacing: -0.02em; }
  @media (max-width: 767px) { .meal-plan-section-header__heading { font-size: 2rem !important; } }
  .meal-plan-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 30px; list-style: none; padding: 0; margin: 0; }
  @media (max-width: 767px) { .meal-plan-grid { grid-template-columns: 1fr; gap: 20px; } }

  /* --- Prestige Card Base --- */
  .meal-plan-card {
    display: flex; flex-direction: column; height: 100%; background-color: #fff;
    border-radius: 16px; border: 1px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,.04);
    overflow: hidden; text-decoration: none !important;
    transition: all .25s cubic-bezier(.25,.8,.25,1);
  }
  .meal-plan-card:hover { transform: translateY(-8px); border-color: #d1d9e2; box-shadow: 0 12px 28px rgba(0,0,0,.07), 0 5px 10px rgba(0,0,0,.05); }
  .meal-plan-card * { text-decoration: none !important; }

  .meal-plan-card__promo-header {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 160px; padding: 2rem 1.5rem; text-align: center;
    transition: transform .4s ease;
  }
  .meal-plan-card:hover .meal-plan-card__promo-header { transform: scale(1.03); }

  .meal-plan-card__promo-title {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
    font-size: 2.5rem !important; font-weight: 800 !important; line-height: 1.2 !important;
    color: #ffffff; text-shadow: 0 2px 8px rgba(0,0,0,0.25);
    letter-spacing: -0.02em; margin: 0;
  }
  .meal-plan-card__promo-subtitle {
    font-size: 1rem; font-weight: 500; line-height: 1.4;
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 0 1px 4px rgba(0,0,0,0.25);
    max-width: 35ch;
    margin-top: 0.5rem;
    margin-left: auto; /* THE FIX */
    margin-right: auto; /* THE FIX */
  }

  /* --- Prestige Content Layout --- */
  .meal-plan-card__content { display: flex; flex-direction: column; flex-grow: 1; padding: 2rem; text-align: left; }
  @media (max-width: 767px) { .meal-plan-card__content { padding: 1.5rem; } }
  .meal-plan-card__main-info { flex-grow: 1; }
  
  .meal-plan-card__benefits-block {
    margin: 0 -2rem 1.5rem -2rem; /* Full-bleed effect */
    padding: 1.5rem 2rem;
    background-color: #f8f9fa; border-top: 1px solid #e9ecef; border-bottom: 1px solid #e9ecef;
  }
  @media (max-width: 767px) {
    .meal-plan-card__benefits-block { margin: 0 -1.5rem 1.5rem -1.5rem; padding: 1.5rem; }
  }

  .meal-plan-card__benefits-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.75rem; }
  .meal-plan-card__benefit-item { display: flex; align-items: flex-start; gap: 0.75rem; color: #343a40; font-weight: 500; }
  .meal-plan-card__benefit-item svg { flex-shrink: 0; width: 20px; height: 20px; margin-top: 2px; color: var(--brand-accent, #2EBF7A); }
  
  .meal-plan-card__benefit-item span {
    display: block;
  }
  @media (max-width: 767px) {
    .meal-plan-card__benefit-item {
      display: block;
      padding-left: 28px; /* icon width (20) + gap (8) */
      position: relative;
    }
    .meal-plan-card__benefit-item svg {
      position: absolute;
      left: 0;
      top: 2px;
    }
  }

  .meal-plan-card__description { font-size: 1rem; line-height: 1.6; color: #495057 !important; margin: 0; }
  .meal-plan-card__description p:last-child { margin-bottom: 0; }

  /* --- Prestige CTA Footer --- */
  .meal-plan-card__cta-wrapper { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e9ecef; }
  .meal-plan-card__options-bar {
    display: flex;
    flex-wrap: nowrap;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  .meal-plan-card__option-pill {
    display: inline-flex; align-items: center; gap: 0.5rem;
    font-size: 0.8rem; font-weight: 600; color: #495057;
    background-color: #f8f9fa; border-radius: 99px;
    padding: 0.4rem 0.8rem;
    white-space: nowrap;
  }
  .meal-plan-card__option-pill svg { width: 16px; height: 16px; stroke-width: 2; color: #6c757d; }
  
  @media (max-width: 767px) {
    .meal-plan-card__option-pill {
      font-size: 0.75rem;
      padding: 0.3rem 0.6rem;
      gap: 0.35rem;
    }
    .meal-plan-card__option-pill svg {
      width: 14px;
      height: 14px;
    }
  }

  .meal-plan-card__cta {
    display: inline-block; width: 100%; text-align: center;
    background-color: #fff !important; border: 2px solid var(--brand-accent,#2EBF7A) !important;
    color: var(--brand-accent,#2EBF7A) !important; border-radius: 8px; font-size: 1rem;
    font-weight: 700 !important; text-transform: uppercase !important; letter-spacing: .05em;
    cursor: pointer; padding: .85rem 1.5rem; transition: all .2s ease;
  }
  .meal-plan-card:hover .meal-plan-card__cta { background-color: var(--brand-accent,#2EBF7A) !important; color: #fff !important; }

</style>

<div class="meal-plan-section-wrapper">
  <div class="container">
    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="meal-plan-section-header">
        {%- if section.settings.subheading != blank -%}
          <p class="meal-plan-section-header__subheading">{{ section.settings.subheading | escape }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="meal-plan-section-header__heading">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="meal-plan-grid">
        {%- for block in section.blocks -%}
          {%- liquid
            assign product = block.settings.plan_product
            assign promo_title = block.settings.promo_title | default: product.title
            assign hook_line = product.metafields.plan.hook_line
            assign who_for_list = product.metafields.plan.who_for_list.value
            assign has_hook = false
            if block.settings.show_hook_line and hook_line != blank
              assign has_hook = true
            endif
            assign has_benefits = false
            if block.settings.show_who_for_list and who_for_list.size > 0
              assign has_benefits = true
            endif
          -%}

          <div class="meal-plan-grid__item" {{ block.shopify_attributes }}>
            <a href="{{ product.url | default: '#' }}" class="meal-plan-card">
              <div
                class="meal-plan-card__promo-header"
                style="background: linear-gradient(65deg, {{ block.settings.gradient_start }}, {{ block.settings.gradient_end }});"
              >
                <div class="meal-plan-card__promo-text-wrapper">
                  <h2 class="meal-plan-card__promo-title">{{ promo_title | escape }}</h2>
                  {%- if has_hook -%}
                    <p class="meal-plan-card__promo-subtitle">{{ hook_line }}</p>
                  {%- endif -%}
                </div>
              </div>

              <div class="meal-plan-card__content">
                <div class="meal-plan-card__main-info">
                  {%- if has_benefits -%}
                    <div class="meal-plan-card__benefits-block">
                      <ul class="meal-plan-card__benefits-list">
                        {%- for item in who_for_list limit: block.settings.who_for_limit -%}
                          <li class="meal-plan-card__benefit-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            <span>{{ item }}</span>
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  {%- endif -%}

                  <div class="meal-plan-card__description">
                    {{- block.settings.description | default: product.description -}}
                  </div>
                </div>

                <div class="meal-plan-card__cta-wrapper">
                  {%- if block.settings.show_options_bar -%}
                    <div class="meal-plan-card__options-bar">
                      {%- if block.settings.option_1_text != blank -%}
                        <div class="meal-plan-card__option-pill">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                          <span>{{ block.settings.option_1_text }}</span>
                        </div>
                      {%- endif -%}
                      {%- if block.settings.option_2_text != blank -%}
                         <div class="meal-plan-card__option-pill">
                          <span>{{ block.settings.option_2_text }}</span>
                        </div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}

                  <span class="meal-plan-card__cta">{{ block.settings.button_text | escape }}</span>
                </div>
              </div>
            </a>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Custom Meal Plan Grid",
  "class": "custom-meal-plan-section",
  "settings": [
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "THE MOST CONVENIENT WAY TO MEAL PREP" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "One-Click Meal Plans" }
  ],
  "blocks": [
    {
      "type": "plan_card",
      "name": "Meal Plan Card",
      "settings": [
        { "type": "product", "id": "plan_product", "label": "Meal Plan Product" },
        { "type": "header", "content": "Promo Header Settings" },
        { "type": "text", "id": "promo_title", "label": "Promo Header Title", "info": "Leave blank to use the product's title." },
        { "type": "color", "id": "gradient_start", "label": "Gradient Start Color", "default": "#28a745" },
        { "type": "color", "id": "gradient_end", "label": "Gradient End Color", "default": "#20c997" },
        { "type": "header", "content": "Card Content Settings" },
        { "type": "checkbox", "id": "show_hook_line", "label": "Show 'Hook Line' as subtitle", "default": true },
        { "type": "checkbox", "id": "show_who_for_list", "label": "Show 'Who It's For' from metafield", "default": true },
        {
          "type": "range",
          "id": "who_for_limit",
          "min": 1,
          "max": 5,
          "step": 1,
          "label": "Max 'Who It's For' items to show",
          "default": 1
        },
        { "type": "checkbox", "id": "show_options_bar", "label": "Show Purchase Options Bar", "default": true },
        { "type": "text", "id": "option_1_text", "label": "Option 1 Text (Meal Count)", "default": "12 or 24 Meals" },
        { "type": "text", "id": "option_2_text", "label": "Option 2 Text (Purchase Type)", "default": "One-Time or Subscribe" },
        { "type": "richtext", "id": "description", "label": "Description Override", "info": "Optional. Leave blank to use the selected product's description.", "default": "<p>Enjoy a high-fat, low-carb assortment of chef-crafted meals designed to keep you on track and fully satisfied.</p>" },
        { "type": "text", "id": "button_text", "label": "Button Text", "default": "View Plan" }
      ]
    }
  ],
  "presets": [
    { "name": "Custom Meal Plan Grid", "blocks": [{ "type": "plan_card" }, { "type": "plan_card" }] }
  ],
  "enabled_on": {
    "templates": ["*"]
  }
}
{% endschema %}
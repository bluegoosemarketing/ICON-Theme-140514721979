{%- comment -%}
  Section: Story Process - "Momentum Timeline" (World Class V9 - Final Polish)
  Updates:
  1. NUMBERS: Lifted up ("breathing room") + Solid White (85% Opacity) per request.
  2. LAYOUT: Retained the "Inset Frame" and "Scattered Momentum" background.
  3. STRUCTURE: Structural rail connecting the steps.
{%- endcomment -%}

<div class="story-process-section">
  
  <!-- BACKGROUND: Organic Forward Motion -->
  <div class="story-bg-momentum"></div>

  <div class="story-container">
    
    <!-- Section Header -->
    <div class="story-header">
      {% if section.settings.heading != blank %}
        <h2 class="story-h2">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <p class="story-sub">{{ section.settings.subheading }}</p>
      {% endif %}
    </div>

    <!-- THE TIMELINE -->
    <div class="story-timeline-wrapper">
      
      <!-- The Structural Rail -->
      <div class="story-rail-track">
        <div class="story-rail-line"></div>
      </div>

      <div class="story-grid">
        {%- for block in section.blocks -%}
          <div class="story-module" {{ block.shopify_attributes }}>
            
            <!-- Connection Point -->
            <div class="story-connector">
              <div class="story-dot"></div>
              <div class="story-vertical-link"></div>
            </div>

            <!-- Card -->
            <div class="story-card-inner">
              
              <div class="story-img-wrap">
                <!-- WATERMARK NUMBER (Lifted + White 85%) -->
                <div class="story-watermark">0{{ forloop.index }}</div>

                {%- if block.settings.image != blank -%}
                  {{ block.settings.image | image_url: width: 600 | image_tag: class: 'story-img', loading: 'lazy', alt: block.settings.title }}
                {%- else -%}
                  <div class="story-placeholder">
                    {{ 'image' | placeholder_svg_tag: 'story-placeholder-svg' }}
                  </div>
                {%- endif -%}
              </div>

              <div class="story-content">
                {% if block.settings.title != blank %}
                  <h3>{{ block.settings.title }}</h3>
                {% endif %}
                {% if block.settings.text != blank %}
                  <div class="story-text">{{ block.settings.text }}</div>
                {% endif %}
              </div>
            </div>
            
          </div>
        {%- endfor -%}
      </div>
    </div>

  </div>
</div>

<style>
/* --- 1. CORE LAYOUT & BACKGROUND --- */
.story-process-section {
  background-color: #F5F7FA !important; 
  padding: 80px 0 100px 0 !important; 
  width: 100% !important; 
  position: relative !important;
  z-index: 10 !important;
  overflow: hidden !important;
}

/* BACKGROUND (Momentum Arrows) */
.story-bg-momentum {
  position: absolute !important; inset: 0 !important;
  background-image: url("data:image/svg+xml,%3Csvg width='800' height='600' viewBox='0 0 800 600' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3C!-- Stream 1 --%3E%3Cpath d='M 50 80 L 70 100 L 50 120' stroke='%23B0B5C0' stroke-width='3' stroke-opacity='0.18'/%3E%3Cpath d='M 80 80 L 100 100 L 80 120' stroke='%23B0B5C0' stroke-width='3' stroke-opacity='0.15'/%3E%3C!-- Stream 2 (Hero) --%3E%3Cpath d='M 550 300 L 580 330 L 550 360' stroke='%23B0B5C0' stroke-width='4' stroke-opacity='0.2'/%3E%3Cpath d='M 580 300 L 610 330 L 580 360' stroke='%23D11F1F' stroke-width='4' stroke-opacity='0.1'/%3E%3C!-- Stream 3 --%3E%3Cpath d='M 120 480 L 135 495 L 120 510' stroke='%23B0B5C0' stroke-width='3' stroke-opacity='0.12'/%3E%3C!-- Stream 4 --%3E%3Cpath d='M 700 50 L 720 70 L 700 90' stroke='%23B0B5C0' stroke-width='3' stroke-opacity='0.15'/%3E%3C/g%3E%3C/svg%3E");
  background-size: 800px 600px !important;
  background-position: center top !important;
  opacity: 1 !important;
  pointer-events: none !important;
  mask-image: linear-gradient(to bottom, black 0%, black 85%, transparent 100%) !important;
  -webkit-mask-image: linear-gradient(to bottom, black 0%, black 85%, transparent 100%) !important;
}

.story-container { 
  width: 100% !important; max-width: 1440px !important; margin: 0 auto !important; padding: 0 40px !important; box-sizing: border-box !important; position: relative !important; z-index: 2 !important;
}

/* --- 2. HEADER --- */
.story-header { 
  text-align: center !important; margin-bottom: 50px !important; max-width: 700px !important; margin-left: auto !important; margin-right: auto !important;
}
.story-h2 { 
  font-family: 'Inter', sans-serif !important; font-size: 3rem !important; margin: 0 0 12px 0 !important; color: #1A1A1A !important; line-height: 1 !important; font-weight: 900 !important; letter-spacing: -0.03em !important; text-transform: uppercase !important;
}
.story-sub { 
  font-family: 'Inter', sans-serif !important; font-size: 1.1rem !important; color: #666 !important; margin: 0 !important; line-height: 1.5 !important;
}

/* --- 3. RAIL SYSTEM --- */
.story-timeline-wrapper { position: relative !important; }

.story-rail-track {
  position: absolute !important; top: 9px !important; left: 0 !important; right: 0 !important; height: 2px !important; z-index: 1 !important;
}
.story-rail-line { width: 100% !important; height: 100% !important; background: #E0E0E0 !important; }

.story-grid { 
  display: grid !important; grid-template-columns: repeat(4, 1fr) !important; gap: 24px !important; align-items: start !important; position: relative !important; z-index: 2 !important;
}

/* --- 4. MODULE & STYLING --- */
.story-module { position: relative !important; display: flex !important; flex-direction: column !important; }

.story-connector {
  position: relative !important; height: 20px !important; margin-left: 24px !important; border-left: 2px solid #E0E0E0 !important; z-index: 5 !important;
}
.story-dot {
  position: absolute !important; top: -6px !important; left: -8px !important; width: 14px !important; height: 14px !important; background: #D11F1F !important; border-radius: 50% !important; box-shadow: 0 0 0 4px #F5F7FA !important; 
}

/* Premium Card */
.story-card-inner {
  background: #FFFFFF !important; padding: 12px !important; border-radius: 12px !important; border: 1px solid rgba(0,0,0,0.08) !important; 
  box-shadow: 0 4px 20px rgba(0,0,0,0.03), inset 0 0 0 1px rgba(255,255,255,0.5) !important;
  transition: transform 0.3s ease, box-shadow 0.3s ease !important; position: relative !important; overflow: hidden !important;
}

.story-module:hover .story-card-inner {
  transform: translateY(-6px) !important; box-shadow: 0 15px 40px rgba(0,0,0,0.08) !important; border-color: rgba(209, 31, 31, 0.15) !important;
}

/* Image Wrapper */
.story-img-wrap {
  position: relative !important; width: 100% !important; aspect-ratio: 3/4 !important; border-radius: 8px !important; overflow: hidden !important;
  margin-bottom: 16px !important; background: #F0F0F0 !important; z-index: 1 !important;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.06) !important;
}

.story-img {
  width: 100% !important; height: 100% !important; object-fit: cover !important; transition: transform 0.6s ease !important; position: relative !important; z-index: 1 !important;
}
.story-module:hover .story-img { transform: scale(1.04) !important; }

/* 
   FIXED WATERMARK
   - Position: Lifted up (-2px) to provide breathing room from bottom border.
   - Style: Solid White at 85% Opacity. Clean, premium, legible.
*/
.story-watermark {
  position: absolute !important;
  top: auto !important; 
  bottom: -2px !important; /* LIFTED UP */
  left: 5px !important; 
  
  font-family: 'Inter', sans-serif !important;
  font-weight: 900 !important;
  font-size: 5rem !important;
  line-height: 1 !important;
  z-index: 5 !important;
  pointer-events: none !important;

  /* Solid Style (No Blend) */
  color: rgba(255, 255, 255, 0.85) !important; /* 85% Opacity */
  mix-blend-mode: normal !important;
  text-shadow: 0 2px 10px rgba(0,0,0,0.15) !important;
}

/* --- 6. CONTENT --- */
.story-content { position: relative !important; z-index: 1 !important; padding: 0 4px 4px 4px !important; }

.story-card-inner h3 { 
  font-family: 'Inter', sans-serif !important; font-weight: 800 !important; font-size: 1.1rem !important; margin: 0 0 4px 0 !important; color: #222 !important; letter-spacing: -0.01em !important; text-transform: uppercase !important;
}
.story-text, .story-text p { 
  font-family: 'Inter', sans-serif !important; font-size: 0.9rem !important; color: #666 !important; line-height: 1.4 !important; margin: 0 !important; 
}

/* --- 7. RESPONSIVE --- */
@media (max-width: 1024px) {
  .story-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 20px !important; }
  .story-rail-track { display: none !important; } 
  .story-connector { display: none !important; }
  
  /* Mobile Numbering adjustment */
  .story-watermark { font-size: 4rem !important; bottom: -5px !important; left: 5px !important; }
}
@media (max-width: 600px) {
  .story-grid { grid-template-columns: 1fr !important; }
  .story-process-section { padding: 60px 0 !important; }
  .story-h2 { font-size: 2.2rem !important; }
}
</style>

{% schema %}
{
  "name": "Story Process",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Your new routine" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "From our kitchen to your table. Consistency made simple." }
  ],
  "blocks": [
    {
      "type": "step",
      "name": "Process Step",
      "limit": 4,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Step Image (Portrait)" },
        { "type": "text", "id": "title", "label": "Title", "default": "Step Title" },
        { "type": "richtext", "id": "text", "label": "Text", "default": "<p>Description here.</p>" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Story Process",
      "blocks": [
        { "type": "step", "settings": { "title": "Choose Once", "text": "<p>Pick meals that fit your goals.</p>" } },
        { "type": "step", "settings": { "title": "Stay Ready", "text": "<p>We cook & ship fresh.</p>" } },
        { "type": "step", "settings": { "title": "Eat Consistently", "text": "<p>No prep. No thinking.</p>" } },
        { "type": "step", "settings": { "title": "Repeat", "text": "<p>Skip when you don't.</p>" } }
      ]
    }
  ]
}
{% endschema %}
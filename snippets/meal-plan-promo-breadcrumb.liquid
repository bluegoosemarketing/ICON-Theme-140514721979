{% comment %}
  Renders meal plan promotion breadcrumb elements based on context.
  Usage: {% render 'meal-plan-promo-breadcrumb', context: 'list-line' %}
{% endcomment %}

{% assign promo_end = settings.meal_plan_promo_end_date | default: '' %}
{% assign promo_end_timestamp = promo_end | date: '%s' %}
{% assign now_timestamp = 'now' | date: '%s' %}
{% assign promo_active = false %}
{% if settings.meal_plan_promo_enable %}
  {% if promo_end == blank or promo_end_timestamp >= now_timestamp %}
    {% assign promo_active = true %}
  {% endif %}
{% endif %}

{% if promo_active %}
  {% case context %}
    {% when 'list-line' %}
      {% if settings.meal_plan_promo_list_enable %}
        <div class="mp-promo-line">
          <span>{{ settings.meal_plan_promo_name }} is live. Save up to $180 with Subscribe & Save. Ends {{ settings.meal_plan_promo_end_date | date: '%b %-d' }}.</span>
          <details class="mp-promo-how"><summary>How it works</summary><div>Extra savings apply to your first 4 boxes when you choose Subscribe & Save. Amount varies by plan size.</div></details>
        </div>
      {% endif %}
    {% when 'plan-card' %}
      {% if settings.meal_plan_promo_list_enable %}
        <div class="mp-plan-card-badge">
          <span class="mp-badge">Save up to $180</span>
          <small class="mp-sub">Applied to first 4 boxes with Subscribe & Save.</small>
        </div>
      {% endif %}
    {% when 'pdp' %}
      <!-- REPLACED: Redundant promo text with Trust/Assurance Signal -->
      <div class="mp-pdp-callout">
        <div class="mp-trust-badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="M9 12l2 2 4-4"></path></svg>
          <span>No commitment. Pause or cancel anytime.</span>
        </div>
      </div>
    {% when 'cart-item' %}
      {% if settings.meal_plan_promo_cart_enable and item %}
        {% assign is_meal_plan = false %}
        {% assign product_type_lower = item.product.type | downcase %}
        {% if product_type_lower contains 'meal plan' or item.product.handle contains 'meal-plan' %}
          {% assign is_meal_plan = true %}
        {% endif %}
        {% if is_meal_plan and item.selling_plan_allocation %}
          <div class="mp-cart-note">
            <span>Black Friday savings applied.</span>
            <small>Box 1 savings shown. Boxes 2â€“4 auto-apply with Subscribe & Save.</small>
          </div>
        {% endif %}
      {% endif %}
  {% endcase %}
{% endif %}

<style>
  /* Base Styles */
  .mp-promo-line { font-size: 0.875rem; margin-top: 0.5rem; text-align: center; }
  .mp-promo-line details { display: inline-block; margin-left: 0.5rem; }
  
  /* Plan Card Badge */
  .mp-plan-card-badge { text-align: center; margin-bottom: 0.5rem; }
  .mp-plan-card-badge .mp-badge { 
    display: inline-block; 
    background: #D42828; 
    color: #fff; 
    font-size: 0.75rem; 
    padding: 0.1rem 0.5rem; 
    border-radius: 4px; 
    font-weight: 700;
  }
  .mp-plan-card-badge .mp-sub { display: block; font-size: 0.75rem; color: #495057; margin-top: 0.25rem; }

  /* Trust Badge Styles (Better use of space) */
  .mp-pdp-callout { margin-top: 1rem; margin-bottom: 0.5rem; }
  .mp-trust-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    color: #495057; /* Neutral dark grey */
  }
  .mp-trust-badge svg {
    color: #2a9d8f; /* ICON Brand Teal for positive affirmation */
    flex-shrink: 0;
  }

  /* Cart Note */
  .mp-cart-note { font-size: 0.75rem; color: #495057; margin-top: 0.25rem; }
  .mp-cart-note span { color: #D42828; font-weight: 700; display: block; }
</style>